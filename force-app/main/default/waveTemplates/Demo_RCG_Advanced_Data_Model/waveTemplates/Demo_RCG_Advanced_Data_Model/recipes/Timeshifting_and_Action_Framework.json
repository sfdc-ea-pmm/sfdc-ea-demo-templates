{
  "name" : "Timeshifting_and_Action_Framework",
  "label" : "- Timeshifting and Action Framework",
  "scheduleExpression" : null,
  "publishingTarget" : "DATASET",
  "format" : "R3",
  "scheduleType" : null,
  "recipeDefinition" : {
    "version" : "58.0",
    "nodes" : {
      "LOAD_DATASET0" : {
        "action" : "load",
        "sources" : [ ],
        "parameters" : {
          "fields" : [ ],
          "dataset" : {
            "type" : "analyticsDataset",
            "label" : "Demo | Account Metrics",
            "name" : "${App.Datasets.Demo_Account_Metrics.FullyQualifiedName}"
          },
          "sampleDetails" : {
            "type" : "TopN",
            "sortBy" : [ ]
          }
        }
      },
      "LOAD_DATASET1" : {
        "action" : "load",
        "sources" : [ ],
        "parameters" : {
          "fields" : [
            "Parent_Account_Name__c",
            "Id",
            "Name",
            "ShippingCity",
            "ShippingState",
            "External_ID__c",
            "cgcloud__Sales_Org__c"
          ],
          "dataset" : {
            "type" : "connectedDataset",
            "label" : "Account",
            "connectionName" : "SFDC_LOCAL",
            "sourceObjectName" : "Account"
          },
          "sampleDetails" : {
            "type" : "TopN",
            "sortBy" : [ ]
          }
        }
      },
      "LOAD_DATASET2" : {
        "action" : "load",
        "sources" : [ ],
        "parameters" : {
          "fields" : [
            "cgcloud__Account__c",
            "cgcloud__Priority__c"
          ],
          "dataset" : {
            "type" : "connectedDataset",
            "label" : "cgcloud__Account_Extension__c",
            "connectionName" : "SFDC_LOCAL",
            "sourceObjectName" : "cgcloud__Account_Extension__c"
          },
          "sampleDetails" : {
            "type" : "TopN",
            "sortBy" : [ ]
          }
        }
      },
      "JOIN0" : {
        "action" : "join",
        "sources" : [
          "LOAD_DATASET1",
          "LOAD_DATASET2"
        ],
        "schema" : {
          "fields" : [ ],
          "slice" : {
            "mode" : "DROP",
            "ignoreMissingFields" : true,
            "fields" : [ ]
          }
        },
        "parameters" : {
          "joinType" : "LOOKUP",
          "leftKeys" : [
            "Id"
          ],
          "rightQualifier" : "AccountExtension",
          "rightKeys" : [
            "cgcloud__Account__c"
          ]
        }
      },
      "UPDATE0" : {
        "action" : "update",
        "sources" : [
          "LOAD_DATASET0",
          "JOIN0"
        ],
        "parameters" : {
          "leftKeys" : [
            "Account_External_Id"
          ],
          "rightKeys" : [
            "External_ID__c"
          ],
          "updateColumns" : {
            "Account_Id" : "Id",
            "State" : "ShippingState",
            "Account_Priority" : "AccountExtension.cgcloud__Priority__c",
            "Account_Name" : "Name",
            "City" : "ShippingCity",
            "Sales_Org" : "cgcloud__Sales_Org__c",
            "Parent_Account" : "Parent_Account_Name__c"
          }
        }
      },
      "OUTPUT0" : {
        "action" : "save",
        "sources" : [
          "UPDATE2"
        ],
        "parameters" : {
          "fields" : [ ],
          "dataset" : {
            "type" : "analyticsDataset",
            "label" : "Demo | Account Metrics",
            "name" : "${App.Datasets.Demo_Account_Metrics.Name}",
            "folderName" : "${App.Folder.FullyQualifiedName}"
          },
          "measuresToCurrencies" : [ ]
        }
      },
      "FORMULA0" : {
        "action" : "formula",
        "sources" : [
          "UPDATE0"
        ],
        "parameters" : {
          "expressionType" : "SQL",
          "fields" : [
            {
              "type" : "NUMBER",
              "name" : "ElapsedYears",
              "label" : "ElapsedYears",
              "formulaExpression" : "year(now()) - year(LastProcessedDate)",
              "precision" : 10,
              "scale" : 0,
              "defaultValue" : ""
            }
          ]
        }
      },
      "FORMULA1" : {
        "action" : "formula",
        "sources" : [
          "FORMULA0"
        ],
        "parameters" : {
          "expressionType" : "SQL",
          "fields" : [
            {
              "type" : "DATETIME",
              "name" : "DateAux",
              "label" : "DateAux",
              "formulaExpression" : "Date - INTERVAL 0 DAY",
              "format" : "yyyy-MM-dd",
              "defaultValue" : ""
            }
          ]
        }
      },
      "DROP_FIELDS0" : {
        "action" : "schema",
        "sources" : [
          "FORMULA1"
        ],
        "parameters" : {
          "fields" : [ ],
          "slice" : {
            "mode" : "DROP",
            "ignoreMissingFields" : true,
            "fields" : [
              "Date",
              "LastProcessedDate"
            ]
          }
        }
      },
      "FORMULA2" : {
        "action" : "formula",
        "sources" : [
          "DROP_FIELDS0"
        ],
        "parameters" : {
          "expressionType" : "SQL",
          "fields" : [
            {
              "type" : "DATETIME",
              "name" : "Date",
              "label" : "Date",
              "formulaExpression" : "to_timestamp(to_unix_timestamp(DateAux) + 86400 * 365 * ElapsedYears)",
              "format" : "yyyy-MM-dd",
              "defaultValue" : ""
            }
          ]
        }
      },
      "DROP_FIELDS1" : {
        "action" : "schema",
        "sources" : [
          "FORMULA2"
        ],
        "parameters" : {
          "fields" : [ ],
          "slice" : {
            "mode" : "DROP",
            "ignoreMissingFields" : true,
            "fields" : [
              "ElapsedYears",
              "DateAux"
            ]
          }
        }
      },
      "FORMULA3" : {
        "action" : "formula",
        "sources" : [
          "DROP_FIELDS1"
        ],
        "parameters" : {
          "expressionType" : "SQL",
          "fields" : [
            {
              "type" : "DATETIME",
              "name" : "LastProcessedDate",
              "label" : "LastProcessedDate",
              "formulaExpression" : "now()",
              "format" : "yyyy-MM-dd",
              "defaultValue" : ""
            }
          ]
        }
      },
      "LOAD_DATASET3" : {
        "action" : "load",
        "sources" : [ ],
        "parameters" : {
          "fields" : [
            "Id",
            "Name",
            "Family",
            "External_ID__c",
            "Brand__c",
            "RCG_Product_Category__c",
            "RCG_Product_Category_Name__c"
          ],
          "dataset" : {
            "type" : "connectedDataset",
            "label" : "Product2",
            "connectionName" : "SFDC_LOCAL",
            "sourceObjectName" : "Product2"
          },
          "sampleDetails" : {
            "type" : "TopN",
            "sortBy" : [ ]
          }
        }
      },
      "UPDATE1" : {
        "action" : "update",
        "sources" : [
          "FORMULA3",
          "LOAD_DATASET3"
        ],
        "parameters" : {
          "leftKeys" : [
            "Product_External_Id"
          ],
          "rightKeys" : [
            "External_ID__c"
          ],
          "updateColumns" : {
            "Product_Category" : "RCG_Product_Category_Name__c",
            "Product_Id" : "Id",
            "Product_Name" : "Name",
            "Product_Brand" : "Brand__c"
          }
        }
      },
      "LOAD_DATASET4" : {
        "action" : "load",
        "sources" : [ ],
        "parameters" : {
          "fields" : [
            "External_ID__c",
            "SmallPhotoUrl",
            "Id",
            "Name"
          ],
          "dataset" : {
            "type" : "connectedDataset",
            "label" : "User",
            "connectionName" : "SFDC_LOCAL",
            "sourceObjectName" : "User"
          },
          "sampleDetails" : {
            "type" : "TopN",
            "sortBy" : [ ]
          }
        }
      },
      "UPDATE2" : {
        "action" : "update",
        "sources" : [
          "UPDATE1",
          "LOAD_DATASET4"
        ],
        "parameters" : {
          "leftKeys" : [
            "SalesRepExternalId"
          ],
          "rightKeys" : [
            "External_ID__c"
          ],
          "updateColumns" : {
            "Sales_Rep_Name" : "Name",
            "SalesRepSmallPhotoUrl" : "SmallPhotoUrl",
            "SalesRepId" : "Id"
          }
        }
      }
    },
    "ui" : {
      "nodes" : {
        "LOAD_DATASET0" : {
          "label" : "Demo | Account Metrics",
          "type" : "LOAD_DATASET",
          "top" : 112,
          "left" : 112,
          "parameters" : {
            "sampleSize" : 2000
          }
        },
        "LOAD_DATASET1" : {
          "label" : "Account",
          "type" : "LOAD_DATASET",
          "top" : 252,
          "left" : 112,
          "parameters" : {
            "sampleSize" : 2000
          }
        },
        "LOAD_DATASET2" : {
          "label" : "cgcloud__Account_Extension__c",
          "type" : "LOAD_DATASET",
          "top" : 392,
          "left" : 112,
          "parameters" : {
            "sampleSize" : 2000
          }
        },
        "JOIN0" : {
          "label" : "Augment Account w Acct Extension",
          "description" : "",
          "type" : "JOIN",
          "top" : 252,
          "left" : 252
        },
        "UPDATE0" : {
          "label" : "Update Account Data",
          "description" : "",
          "type" : "UPDATE",
          "top" : 252,
          "left" : 392
        },
        "OUTPUT0" : {
          "label" : "Save Account Metrics",
          "description" : "",
          "type" : "OUTPUT",
          "top" : 252,
          "left" : 952
        },
        "TRANSFORM0" : {
          "label" : "Acct. Metrics Timeshifting",
          "description" : "",
          "type" : "TRANSFORM",
          "top" : 252,
          "left" : 532,
          "graph" : {
            "FORMULA0" : {
              "parameters" : {
                "type" : "BASE_FORMULA_UI"
              },
              "label" : "Elapsed Years"
            },
            "FORMULA1" : {
              "parameters" : {
                "type" : "DATE_ADD_SUBTRACT_UI"
              },
              "label" : "Aux Date"
            },
            "DROP_FIELDS0" : {
              "label" : "Drop Date Columns"
            },
            "FORMULA2" : {
              "parameters" : {
                "type" : "BASE_FORMULA_UI"
              },
              "label" : "Shift Dates"
            },
            "DROP_FIELDS1" : {
              "label" : "Drop Aux Columns"
            },
            "FORMULA3" : {
              "parameters" : {
                "type" : "DATE_NOW_UI"
              },
              "label" : "Add LPD"
            }
          },
          "connectors" : [
            {
              "source" : "FORMULA0",
              "target" : "FORMULA1"
            },
            {
              "source" : "FORMULA1",
              "target" : "DROP_FIELDS0"
            },
            {
              "source" : "DROP_FIELDS0",
              "target" : "FORMULA2"
            },
            {
              "source" : "FORMULA2",
              "target" : "DROP_FIELDS1"
            },
            {
              "source" : "DROP_FIELDS1",
              "target" : "FORMULA3"
            }
          ]
        },
        "LOAD_DATASET3" : {
          "label" : "Product2",
          "type" : "LOAD_DATASET",
          "top" : 532,
          "left" : 112,
          "parameters" : {
            "sampleSize" : 2000
          }
        },
        "UPDATE1" : {
          "label" : "Update Product Data",
          "description" : "",
          "type" : "UPDATE",
          "top" : 251.89999999999998,
          "left" : 672
        },
        "LOAD_DATASET4" : {
          "label" : "User",
          "type" : "LOAD_DATASET",
          "top" : 672,
          "left" : 112,
          "parameters" : {
            "sampleSize" : 2000
          }
        },
        "UPDATE2" : {
          "label" : "Update Rep Data",
          "description" : "",
          "type" : "UPDATE",
          "top" : 251.89999999999998,
          "left" : 812
        }
      },
      "connectors" : [
        {
          "source" : "LOAD_DATASET1",
          "target" : "JOIN0"
        },
        {
          "source" : "LOAD_DATASET2",
          "target" : "JOIN0"
        },
        {
          "source" : "LOAD_DATASET0",
          "target" : "UPDATE0"
        },
        {
          "source" : "JOIN0",
          "target" : "UPDATE0"
        },
        {
          "source" : "UPDATE2",
          "target" : "OUTPUT0"
        },
        {
          "source" : "UPDATE0",
          "target" : "TRANSFORM0"
        },
        {
          "source" : "TRANSFORM0",
          "target" : "UPDATE1"
        },
        {
          "source" : "LOAD_DATASET3",
          "target" : "UPDATE1"
        },
        {
          "source" : "UPDATE1",
          "target" : "UPDATE2"
        },
        {
          "source" : "LOAD_DATASET4",
          "target" : "UPDATE2"
        }
      ],
      "hiddenColumns" : [ ]
    },
    "runMode" : "full"
  },
  "lastTime" : null
}