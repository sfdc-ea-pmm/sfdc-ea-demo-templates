{
  "name": "User_CSAT118_tp",
  "label": "User CSAT",
  "folder": {
    "id": "${App.Folder.Id}"
  },
  "dateVersion": 1,
  "mobileDisabled": false,
  "xmd": {
    "measures": [],
    "derivedDimensions": [],
    "organizations": [],
    "showDetailsDefaultFields": [],
    "dates": [],
    "derivedMeasures": [],
    "dimensions": []
  },
  "state": {
    "dataSourceLinks": [
      {
        "fields": [
          {
            "dataSourceName": "${App.Datasets.Contacts_tp.Name}",
            "dataSourceNamespace": "${Org.Namespace}",
            "dataSourceType": "saql",
            "fieldName": "Id"
          },
          {
            "dataSourceName": "${App.Datasets.SurveyQuestionResponsewithDetails_tp.Name}",
            "dataSourceNamespace": "${Org.Namespace}",
            "dataSourceType": "saql",
            "fieldName": "Invitation_ParticipantId"
          }
        ],
        "label": "Contact connection",
        "name": "Link_425"
      }
    ],
    "filters": [],
    "gridLayouts": [
      {
        "maxWidth": 540,
        "name": "Default",
        "numColumns": 40,
        "pages": [
          {
            "label": "User CSAT",
            "name": "5fa71dc3-8a9c-413a-9491-ceb9fd6aebc8",
            "navigationHidden": false,
            "widgets": [
              {
                "colspan": 40,
                "column": 0,
                "name": "container_1",
                "row": 0,
                "rowspan": 5,
                "widgetStyle": {
                  "backgroundColor": "#FFFFFF",
                  "borderColor": "#C6D3E1",
                  "borderEdges": [],
                  "borderRadius": 0,
                  "borderWidth": 1
                }
              },
              {
                "colspan": 35,
                "column": 4,
                "name": "text_1",
                "row": 0,
                "rowspan": 5,
                "widgetStyle": {
                  "backgroundColor": "rgba(255, 255, 255, 0)",
                  "borderColor": "#E6ECF2",
                  "borderEdges": [],
                  "borderRadius": 0,
                  "borderWidth": 1
                }
              },
              {
                "colspan": 17,
                "column": 2,
                "name": "container_2",
                "row": 5,
                "rowspan": 13,
                "widgetStyle": {
                  "backgroundColor": "rgb(131, 90, 255)",
                  "borderColor": "#E6ECF2",
                  "borderEdges": [],
                  "borderRadius": 0,
                  "borderWidth": 1
                }
              },
              {
                "colspan": 40,
                "column": 0,
                "name": "container_3",
                "row": 18,
                "rowspan": 10,
                "widgetStyle": {
                  "backgroundColor": "#FFFFFF",
                  "borderColor": "#C6D3E1",
                  "borderEdges": [],
                  "borderRadius": 0,
                  "borderWidth": 1
                }
              },
              {
                "colspan": 19,
                "column": 19,
                "name": "container_4",
                "row": 5,
                "rowspan": 13,
                "widgetStyle": {
                  "backgroundColor": "rgb(241, 244, 248)",
                  "borderColor": "#C6D3E1",
                  "borderEdges": [],
                  "borderRadius": 0,
                  "borderWidth": 1
                }
              },
              {
                "colspan": 15,
                "column": 3,
                "name": "text_2",
                "row": 6,
                "rowspan": 3,
                "widgetStyle": {
                  "backgroundColor": "rgba(255, 255, 255, 0)",
                  "borderColor": "#E6ECF2",
                  "borderEdges": [],
                  "borderRadius": 0,
                  "borderWidth": 1
                }
              },
              {
                "colspan": 17,
                "column": 20,
                "name": "text_3",
                "row": 6,
                "rowspan": 3,
                "widgetStyle": {
                  "backgroundColor": "rgba(255, 255, 255, 0)",
                  "borderColor": "#E6ECF2",
                  "borderEdges": [],
                  "borderRadius": 0,
                  "borderWidth": 1
                }
              },
              {
                "colspan": 38,
                "column": 1,
                "name": "text_4",
                "row": 19,
                "rowspan": 2,
                "widgetStyle": {
                  "backgroundColor": "rgba(255, 255, 255, 0)",
                  "borderColor": "#E6ECF2",
                  "borderEdges": [],
                  "borderRadius": 0,
                  "borderWidth": 1
                }
              },
              {
                "colspan": 38,
                "column": 1,
                "name": "text_5",
                "row": 21,
                "rowspan": 4,
                "widgetStyle": {
                  "borderEdges": []
                }
              },
              {
                "colspan": 38,
                "column": 1,
                "name": "text_6",
                "row": 25,
                "rowspan": 2,
                "widgetStyle": {
                  "backgroundColor": "rgba(255, 255, 255, 0)",
                  "borderColor": "#E6ECF2",
                  "borderEdges": [],
                  "borderRadius": 0,
                  "borderWidth": 1
                }
              },
              {
                "colspan": 15,
                "column": 3,
                "name": "text_7",
                "row": 14,
                "rowspan": 3,
                "widgetStyle": {
                  "backgroundColor": "rgba(255, 255, 255, 0)",
                  "borderColor": "#E6ECF2",
                  "borderEdges": [],
                  "borderRadius": 0,
                  "borderWidth": 1
                }
              },
              {
                "colspan": 17,
                "column": 20,
                "name": "text_8",
                "row": 14,
                "rowspan": 3,
                "widgetStyle": {
                  "backgroundColor": "rgba(255, 255, 255, 0)",
                  "borderColor": "#E6ECF2",
                  "borderEdges": [],
                  "borderRadius": 0,
                  "borderWidth": 1
                }
              },
              {
                "colspan": 17,
                "column": 2,
                "name": "number_1",
                "row": 9,
                "rowspan": 4,
                "widgetStyle": {
                  "backgroundColor": "rgba(255, 255, 255, 0)",
                  "borderColor": "#E6ECF2",
                  "borderEdges": [],
                  "borderRadius": 0,
                  "borderWidth": 1
                }
              },
              {
                "colspan": 19,
                "column": 19,
                "name": "number_2",
                "row": 9,
                "rowspan": 4,
                "widgetStyle": {
                  "backgroundColor": "rgba(255, 255, 255, 0)",
                  "borderColor": "#E6ECF2",
                  "borderEdges": [],
                  "borderRadius": 0,
                  "borderWidth": 1
                }
              },
              {
                "colspan": 3,
                "column": 1,
                "name": "image_1",
                "row": 0,
                "rowspan": 5,
                "widgetStyle": {
                  "backgroundColor": "rgba(255, 255, 255, 0)",
                  "borderColor": "rgba(230, 236, 242, 0)",
                  "borderEdges": ["left", "right"],
                  "borderRadius": 0,
                  "borderWidth": 8
                }
              }
            ]
          }
        ],
        "rowHeight": "fine",
        "selectors": [],
        "style": {
          "alignmentX": "left",
          "alignmentY": "top",
          "backgroundColor": "#FFFFFF",
          "cellSpacingX": 0,
          "cellSpacingY": 0,
          "fit": "original",
          "gutterColor": "#C5D3E0"
        },
        "version": 1.0
      }
    ],
    "layouts": [],
    "steps": {
      "Config_Data_1": {
        "broadcastFacet": true,
        "groups": [],
        "label": "Config Data",
        "numbers": [],
        "query": "config = load \"${App.Datasets.SurveyQuestionResponsewithDetails_tp.FullyQualifiedName}\"; config = filter config by 'Question_QuestionType' == \"Rating\"; config = filter config by 'Invitation_Participant_ParticipantType' == \"User\"; config = foreach config generate 'QuestionId' as 'QuestionId', 'Question_Name' as 'QuestionName', 'Question_QuestionType' as 'QuestionType', 'Invitation_SurveyId' as 'SurveyID', 'SurveyVersion_Survey_Name' as 'SurveyName', 'SurveyVersionId' as 'SurveyVersionID', 'SurveyVersion_VersionNumber' as 'VersionNumber', string_to_number('SurveyVersion_VersionNumber') as 'Version';\nconfig = order config by 'Version' desc;",
        "receiveFacetSource": {
          "mode": "all",
          "steps": []
        },
        "selectMode": "single",
        "strings": [
          "QuestionID",
          "QuestionName",
          "QuestionType",
          "SurveyID",
          "SurveyName",
          "SurveyVersionID",
          "VersionNumber"
        ],
        "type": "saql",
        "useGlobal": true,
        "visualizationParameters": {
          "parameters": {
            "borderColor": "#e0e5ee",
            "borderWidth": 1,
            "cell": {
              "backgroundColor": "#ffffff",
              "fontColor": "#16325c",
              "fontSize": 12
            },
            "columnProperties": {},
            "columns": [],
            "customBulkActions": [],
            "header": {
              "backgroundColor": "#f4f6f9",
              "fontColor": "#16325c",
              "fontSize": 12
            },
            "innerMajorBorderColor": "#a8b7c7",
            "innerMinorBorderColor": "#e0e5ee",
            "maxColumnWidth": 300,
            "minColumnWidth": 40,
            "mode": "variable",
            "numberOfLines": 1,
            "showActionMenu": true,
            "totals": true,
            "verticalPadding": 8
          },
          "type": "table"
        }
      },
      "User_details_1": {
        "broadcastFacet": true,
        "datasets": [
          {
            "name": "${App.Datasets.Contacts_tp.Name}"
          }
        ],
        "isGlobal": false,
        "label": "User details",
        "query": {
          "query": {
            "values": ["Department", "AccountId", "LeadSource", "Id", "Name"],
            "filters": [["ParticipantType", ["User"], "in"]]
          },
          "version": -1.0
        },
        "receiveFacetSource": {
          "mode": "all",
          "steps": []
        },
        "selectMode": "singlerequired",
        "type": "aggregateflex",
        "useGlobal": true,
        "visualizationParameters": {
          "options": {},
          "parameters": {
            "borderColor": "#e0e5ee",
            "borderWidth": 1,
            "cell": {
              "backgroundColor": "#ffffff",
              "fontColor": "#16325c",
              "fontSize": 12
            },
            "columnProperties": {},
            "columns": [],
            "customBulkActions": [],
            "header": {
              "backgroundColor": "#f4f6f9",
              "fontColor": "#16325c",
              "fontSize": 12
            },
            "innerMajorBorderColor": "#a8b7c7",
            "innerMinorBorderColor": "#e0e5ee",
            "maxColumnWidth": 300,
            "minColumnWidth": 40,
            "mode": "variable",
            "numberOfLines": 1,
            "showActionMenu": true,
            "showRowIndexColumn": true,
            "totals": true,
            "verticalPadding": 8
          },
          "type": "table"
        }
      },
      "Average_score_across_1": {
        "broadcastFacet": true,
        "groups": [],
        "label": "Average score across all CSAT surveys for Users",
        "numbers": [],
        "query": "q = load \"${App.Datasets.SurveyQuestionResponsewithDetails_tp.FullyQualifiedName}\"; q = filter q by 'Question_QuestionType' == \"Rating\"; q = filter q by 'Invitation_Participant_ParticipantType' == \"User\"; q = filter q by {{column(Config_Data_1.result, [\"SurveyID\"]).asEquality(\"SurveyVersion_Survey_Id\")}}; q = filter q by {{column(Config_Data_1.result, [\"QuestionId\"]).asEquality(\"QuestionId\")}}; q = group q by ('Id', 'SurveyVersion_Survey_Id', 'SurveyVersionId', 'QuestionId', 'QuestionChoices_Name'); q = foreach q generate 'Id' , 'SurveyVersion_Survey_Id', 'SurveyVersionId', 'QuestionId', 'QuestionChoices_Name' as 'QuestionChoices_Name', first('CreatedDate_sec_epoch') as 'CreatedDate_sec_epoch',  first('NumberValue') as 'NumberValue'; q = order q by ('SurveyVersion_Survey_Id' asc, 'SurveyVersionId' asc, 'QuestionId' asc, 'QuestionChoices_Name' asc); q = group q by ('Id', 'SurveyVersion_Survey_Id', 'SurveyVersionId', 'QuestionId'); q = foreach q generate 'Id' , 'SurveyVersion_Survey_Id', 'SurveyVersionId', 'QuestionId', string_to_number(last('QuestionChoices_Name')) as 'Max Rating', first('CreatedDate_sec_epoch') as 'CreatedDate_sec_epoch',  first('NumberValue') as 'NumberValue'; result = group q by ('SurveyVersion_Survey_Id', 'SurveyVersionId', 'QuestionId'); result = foreach result generate q.'SurveyVersion_Survey_Id' as 'SurveyVersion_Survey_Id', q.'SurveyVersionId' as 'SurveyVersionId', q.'QuestionId' as 'QuestionId', (sum(q.'NumberValue')/sum(q.'Max Rating')) * count(q) as 'Value', count(q) as 'Count', first(q.'Max Rating') as 'Max Rating'; result = group result by all; result = foreach result generate round(((sum(Value)/sum(Count)) * case when {{coalesce(cell(Response_for_Selecte_1.result,0,\"Max Rating\"),0).asObject()}} > 0 then {{coalesce(cell(Response_for_Selecte_1.result,0,\"Max Rating\"),0).asObject()}} else first('Max Rating') end),2)  as 'Avg Score', case when {{coalesce(cell(Response_for_Selecte_1.result,0,\"Max Rating\"),0).asObject()}} > 0 then {{coalesce(cell(Response_for_Selecte_1.result,0,\"Max Rating\"),0).asObject()}} else first('Max Rating') end as 'Max Rating';",
        "receiveFacetSource": {
          "mode": "none",
          "steps": []
        },
        "selectMode": "single",
        "strings": [],
        "type": "saql",
        "useGlobal": false,
        "visualizationParameters": {
          "parameters": {
            "autoFitMode": "keepLabels",
            "showValues": true,
            "bins": {
              "breakpoints": {
                "high": 100,
                "low": 0
              },
              "bands": {
                "high": {
                  "color": "#008000",
                  "label": ""
                },
                "low": {
                  "color": "#B22222",
                  "label": ""
                },
                "medium": {
                  "color": "#ffa500",
                  "label": ""
                }
              }
            },
            "legend": {
              "descOrder": false,
              "showHeader": true,
              "show": true,
              "customSize": "auto",
              "position": "right-top",
              "inside": false
            },
            "axisMode": "multi",
            "tooltip": {
              "showBinLabel": true,
              "measures": "",
              "showNullValues": true,
              "showPercentage": true,
              "showDimensions": true,
              "showMeasures": true,
              "customizeTooltip": false,
              "dimensions": ""
            },
            "visualizationType": "hbar",
            "title": {
              "fontSize": 14,
              "subtitleFontSize": 11,
              "label": "",
              "align": "center",
              "subtitleLabel": ""
            },
            "binValues": false,
            "trellis": {
              "flipLabels": false,
              "showGridLines": true,
              "size": [100, 100],
              "enable": false,
              "type": "x",
              "chartsPerLine": 4
            },
            "showActionMenu": true,
            "measureAxis2": {
              "sqrtScale": false,
              "showTitle": true,
              "showAxis": true,
              "title": "",
              "customDomain": {
                "showDomain": false
              }
            },
            "measureAxis1": {
              "sqrtScale": false,
              "showTitle": true,
              "showAxis": true,
              "title": "",
              "customDomain": {
                "showDomain": false
              }
            },
            "theme": "wave",
            "dimensionAxis": {
              "showTitle": true,
              "customSize": "auto",
              "showAxis": true,
              "title": "",
              "icons": {
                "useIcons": false,
                "iconProps": {
                  "fit": "cover",
                  "column": "",
                  "type": "round"
                }
              }
            },
            "applyConditionalFormatting": true
          },
          "type": "chart"
        }
      },
      "Response_for_Selecte_1": {
        "broadcastFacet": true,
        "groups": ["SurveyVersion_Survey_Id", "SurveyVersionId", "QuestionId"],
        "label": "Response for Selected User",
        "numbers": ["Value", "count", "Max Rating"],
        "query": "q = load \"${App.Datasets.SurveyQuestionResponsewithDetails_tp.FullyQualifiedName}\"; q = filter q by 'Question_QuestionType' == \"Rating\"; q = filter q by 'Invitation_Participant_ParticipantType' == \"User\"; q = group q by ('Id', 'SurveyVersion_Survey_Id', 'SurveyVersionId', 'QuestionId', 'QuestionChoices_Name'); q = foreach q generate 'Id' , 'SurveyVersion_Survey_Id', 'SurveyVersionId', 'QuestionId', 'QuestionChoices_Name' as 'QuestionChoices_Name', first('CreatedDate_sec_epoch') as 'CreatedDate_sec_epoch',  first('NumberValue') as 'NumberValue'; q = order q by ('SurveyVersion_Survey_Id' asc, 'SurveyVersionId' asc, 'QuestionId' asc, 'QuestionChoices_Name' asc); q = group q by ('Id', 'SurveyVersion_Survey_Id', 'SurveyVersionId', 'QuestionId'); q = foreach q generate 'Id' , 'SurveyVersion_Survey_Id', 'SurveyVersionId', 'QuestionId', string_to_number(last('QuestionChoices_Name')) as 'Max Rating', first('CreatedDate_sec_epoch') as 'CreatedDate_sec_epoch',  first('NumberValue') as 'NumberValue';  q = order q by 'CreatedDate_sec_epoch' desc; result = group q by ('SurveyVersion_Survey_Id', 'SurveyVersionId', 'QuestionId'); result = foreach result generate q.'SurveyVersion_Survey_Id' as 'SurveyVersion_Survey_Id', q.'SurveyVersionId' as 'SurveyVersionId', q.'QuestionId' as 'QuestionId', first(q.'NumberValue') as 'Value', count(q) as 'count', first('Max Rating') as 'Max Rating';",
        "receiveFacetSource": {
          "mode": "all",
          "steps": []
        },
        "selectMode": "single",
        "strings": ["SurveyVersion_Survey_Id", "SurveyVersionId", "QuestionId"],
        "type": "saql",
        "useGlobal": true,
        "visualizationParameters": {
          "parameters": {
            "borderColor": "#e0e5ee",
            "borderWidth": 1,
            "cell": {
              "backgroundColor": "#ffffff",
              "fontColor": "#16325c",
              "fontSize": 12
            },
            "columnProperties": {},
            "columns": [],
            "customBulkActions": [],
            "header": {
              "backgroundColor": "#f4f6f9",
              "fontColor": "#16325c",
              "fontSize": 12
            },
            "innerMajorBorderColor": "#a8b7c7",
            "innerMinorBorderColor": "#e0e5ee",
            "maxColumnWidth": 300,
            "minColumnWidth": 40,
            "mode": "variable",
            "numberOfLines": 1,
            "showActionMenu": true,
            "showRowIndexColumn": true,
            "totals": true,
            "verticalPadding": 8
          },
          "type": "table"
        }
      }
    },
    "widgetStyle": {
      "backgroundColor": "#FFFFFF",
      "borderColor": "#E6ECF2",
      "borderEdges": [],
      "borderRadius": 0,
      "borderWidth": 1
    },
    "widgets": {
      "text_1": {
        "parameters": {
          "content": {
            "displayTemplate": "User Customer Satisfaction"
          },
          "fontSize": 18,
          "showActionMenu": true,
          "textAlignment": "left",
          "textColor": "#091A3E"
        },
        "type": "text"
      },
      "container_1": {
        "parameters": {
          "alignmentX": "left",
          "alignmentY": "top",
          "fit": "original"
        },
        "type": "container"
      },
      "number_2": {
        "parameters": {
          "compact": false,
          "exploreLink": true,
          "measureField": "Avg Score",
          "noResultsLabel": "-.-",
          "numberColor": "#091A3E",
          "numberSize": 48,
          "showActionMenu": true,
          "step": "Average_score_across_1",
          "textAlignment": "center",
          "title": "",
          "titleColor": "#091A3E",
          "titleSize": 16
        },
        "type": "number"
      },
      "container_2": {
        "parameters": {
          "alignmentX": "left",
          "alignmentY": "top",
          "fit": "original"
        },
        "type": "container"
      },
      "number_1": {
        "parameters": {
          "compact": false,
          "exploreLink": true,
          "measureField": "Value",
          "noResultsLabel": "-.-",
          "numberColor": "#FFFFFF",
          "numberSize": 48,
          "showActionMenu": true,
          "step": "Response_for_Selecte_1",
          "textAlignment": "center",
          "title": "",
          "titleColor": "#091A3E",
          "titleSize": 10
        },
        "type": "number"
      },
      "container_3": {
        "parameters": {
          "alignmentX": "left",
          "alignmentY": "top",
          "fit": "original"
        },
        "type": "container"
      },
      "container_4": {
        "parameters": {
          "alignmentX": "left",
          "alignmentY": "top",
          "fit": "original"
        },
        "type": "container"
      },
      "text_3": {
        "parameters": {
          "content": {
            "displayTemplate": "AVG. FOR ALL USERS"
          },
          "fontSize": 12,
          "showActionMenu": true,
          "textAlignment": "center",
          "textColor": "#091A3E"
        },
        "type": "text"
      },
      "image_1": {
        "parameters": {
          "alignmentX": "center",
          "alignmentY": "center",
          "fit": "fitwidth",
          "image": {
            "name": "${App.Images['CLA_Iconpng32'].Name}",
            "namespace": "${Org.Namespace}"
          }
        },
        "type": "image"
      },
      "text_2": {
        "parameters": {
          "content": {
            "displayTemplate": "LATEST RATING"
          },
          "fontSize": 12,
          "showActionMenu": true,
          "textAlignment": "center",
          "textColor": "#FFFFFF"
        },
        "type": "text"
      },
      "text_5": {
        "parameters": {
          "content": {
            "displayTemplate": "{{coalesce(cell(Config_Data_1.result,0,\"QuestionName\"),\"Oops!! Looks like configuration is missing.\").asObject()}}"
          },
          "fontSize": 14,
          "showActionMenu": true,
          "textAlignment": "left",
          "textColor": "#091A3E"
        },
        "type": "text"
      },
      "text_4": {
        "parameters": {
          "content": {
            "displayTemplate": "Question:"
          },
          "fontSize": 12,
          "showActionMenu": true,
          "textAlignment": "left",
          "textColor": "#335779"
        },
        "type": "text"
      },
      "text_7": {
        "parameters": {
          "content": {
            "displayTemplate": "OUT OF {{coalesce(cell(Response_for_Selecte_1.result,0,\"Max Rating\"),\"--\").asObject()}}"
          },
          "fontSize": 12,
          "showActionMenu": true,
          "textAlignment": "center",
          "textColor": "#FFFFFF"
        },
        "type": "text"
      },
      "text_6": {
        "parameters": {
          "content": {
            "displayTemplate": "User Name: {{coalesce(cell(User_details_1.result,0,\"Name\"),\"--\").asObject()}}"
          },
          "fontSize": 12,
          "showActionMenu": true,
          "textAlignment": "left",
          "textColor": "#335779"
        },
        "type": "text"
      },
      "text_8": {
        "parameters": {
          "content": {
            "displayTemplate": "OUT OF {{coalesce(cell(Average_score_across_1.result,0,\"Max Rating\"),\"--\").asObject()}}"
          },
          "fontSize": 12,
          "showActionMenu": true,
          "textAlignment": "center",
          "textColor": "#091A3E"
        },
        "type": "text"
      }
    }
  }
}
