{
  "name" : "Single_Customer_s_CSAT_Journey_Embedded_tp",
  "label" : "Single Customer's CSAT Journey (Embedded)",
  "folder" : {
    "id" : "${App.Folder.Id}"
  },
  "dateVersion" : 1,
  "mobileDisabled" : false,
  "xmd" : {
    "measures" : [ ],
    "derivedDimensions" : [ ],
    "organizations" : [ ],
    "showDetailsDefaultFields" : [ ],
    "dates" : [ ],
    "derivedMeasures" : [ ],
    "dimensions" : [ ]
  },
  "state" : {
    "dataSourceLinks" : [
      {
        "fields" : [
          {
            "dataSourceName" : "${App.Datasets.Journey_Survey_Question_Config_Metadata.Name}",
            "dataSourceNamespace" : "${Org.Namespace}",
            "dataSourceType" : "saql",
            "fieldName" : "Journey"
          },
          {
            "dataSourceName" : "${App.Datasets.SurveyQuestionResponsewithDetails.Name}",
            "dataSourceNamespace" : "${Org.Namespace}",
            "dataSourceType" : "saql",
            "fieldName" : "JourneyConfig_Journey"
          }
        ],
        "label" : "Journey Connection",
        "name" : "Link_1427"
      },
      {
        "fields" : [
          {
            "dataSourceName" : "${App.Datasets.Contacts.Name}",
            "dataSourceNamespace" : "${Org.Namespace}",
            "dataSourceType" : "saql",
            "fieldName" : "Id"
          },
          {
            "dataSourceName" : "${App.Datasets.SurveyQuestionResponsewithDetails.Name}",
            "dataSourceNamespace" : "${Org.Namespace}",
            "dataSourceType" : "saql",
            "fieldName" : "Invitation_ParticipantId"
          }
        ],
        "label" : "Participant connection",
        "name" : "Link_289"
      }
    ],
    "filters" : [ ],
    "gridLayouts" : [
      {
        "maxWidth" : 1150,
        "name" : "Default",
        "numColumns" : 50,
        "pages" : [
          {
            "label" : "CSAT - Single Customer's Journey",
            "name" : "6d7f96c8-32fc-408b-bf90-676a3c7da13a",
            "navigationHidden" : false,
            "widgets" : [
              {
                "colspan" : 32,
                "column" : 1,
                "name" : "text_2",
                "row" : 1,
                "rowspan" : 4,
                "widgetStyle" : {
                  "backgroundColor" : "rgba(255, 255, 255, 0)",
                  "borderColor" : "#E6ECF2",
                  "borderEdges" : [ ],
                  "borderRadius" : 0,
                  "borderWidth" : 1
                }
              },
              {
                "colspan" : 9,
                "column" : 2,
                "name" : "text_3",
                "row" : 7,
                "rowspan" : 3,
                "widgetStyle" : {
                  "backgroundColor" : "rgba(255, 255, 255, 0)",
                  "borderColor" : "#E6ECF2",
                  "borderEdges" : [ ],
                  "borderRadius" : 0,
                  "borderWidth" : 1
                }
              },
              {
                "colspan" : 9,
                "column" : 25,
                "name" : "text_4",
                "row" : 7,
                "rowspan" : 3,
                "widgetStyle" : {
                  "backgroundColor" : "rgba(255, 255, 255, 0)",
                  "borderColor" : "#E6ECF2",
                  "borderEdges" : [ ],
                  "borderRadius" : 0,
                  "borderWidth" : 1
                }
              },
              {
                "colspan" : 13,
                "column" : 34,
                "name" : "dateselector_1",
                "row" : 7,
                "rowspan" : 3,
                "widgetStyle" : {
                  "backgroundColor" : "#FFFFFF",
                  "borderColor" : "#E6ECF2",
                  "borderEdges" : [
                    "all"
                  ],
                  "borderRadius" : 4,
                  "borderWidth" : 1
                }
              },
              {
                "colspan" : 9,
                "column" : 2,
                "name" : "text_5",
                "row" : 13,
                "rowspan" : 2,
                "widgetStyle" : {
                  "backgroundColor" : "rgba(255, 255, 255, 0)",
                  "borderColor" : "#E6ECF2",
                  "borderEdges" : [ ],
                  "borderRadius" : 0,
                  "borderWidth" : 1
                }
              },
              {
                "colspan" : 9,
                "column" : 2,
                "name" : "text_6",
                "row" : 25,
                "rowspan" : 2,
                "widgetStyle" : {
                  "backgroundColor" : "rgba(255, 255, 255, 0)",
                  "borderColor" : "#E6ECF2",
                  "borderEdges" : [ ],
                  "borderRadius" : 0,
                  "borderWidth" : 1
                }
              },
              {
                "colspan" : 14,
                "column" : 11,
                "name" : "listselector_1",
                "row" : 7,
                "rowspan" : 3,
                "widgetStyle" : {
                  "backgroundColor" : "#FFFFFF",
                  "borderColor" : "#E6ECF2",
                  "borderEdges" : [
                    "all"
                  ],
                  "borderRadius" : 4,
                  "borderWidth" : 1
                }
              },
              {
                "colspan" : 50,
                "column" : 0,
                "name" : "container_1",
                "row" : 6,
                "rowspan" : 5,
                "widgetStyle" : {
                  "backgroundColor" : "#E6ECF2",
                  "borderColor" : "#E6ECF2",
                  "borderEdges" : [ ],
                  "borderRadius" : 0,
                  "borderWidth" : 1
                }
              },
              {
                "colspan" : 4,
                "column" : 2,
                "name" : "number_2",
                "row" : 21,
                "rowspan" : 3,
                "widgetStyle" : {
                  "backgroundColor" : "rgba(255, 255, 255, 0)",
                  "borderColor" : "#E6ECF2",
                  "borderEdges" : [ ],
                  "borderRadius" : 0,
                  "borderWidth" : 1
                }
              },
              {
                "colspan" : 8,
                "column" : 2,
                "name" : "number_3",
                "row" : 27,
                "rowspan" : 3,
                "widgetStyle" : {
                  "backgroundColor" : "rgba(255, 255, 255, 0)",
                  "borderColor" : "#E6ECF2",
                  "borderEdges" : [ ],
                  "borderRadius" : 0,
                  "borderWidth" : 1
                }
              },
              {
                "colspan" : 9,
                "column" : 2,
                "name" : "text_7",
                "row" : 19,
                "rowspan" : 2,
                "widgetStyle" : {
                  "backgroundColor" : "rgba(255, 255, 255, 0)",
                  "borderColor" : "#E6ECF2",
                  "borderEdges" : [ ],
                  "borderRadius" : 0,
                  "borderWidth" : 1
                }
              },
              {
                "colspan" : 3,
                "column" : 2,
                "name" : "number_1",
                "row" : 15,
                "rowspan" : 3,
                "widgetStyle" : {
                  "borderEdges" : [ ]
                }
              },
              {
                "colspan" : 38,
                "column" : 11,
                "name" : "chart_3",
                "row" : 12,
                "rowspan" : 29,
                "widgetStyle" : {
                  "backgroundColor" : "#FFFFFF",
                  "borderColor" : "#E6ECF2",
                  "borderEdges" : [
                    "left"
                  ],
                  "borderRadius" : 0,
                  "borderWidth" : 1
                }
              }
            ]
          }
        ],
        "rowHeight" : "fine",
        "selectors" : [ ],
        "style" : {
          "alignmentX" : "left",
          "alignmentY" : "top",
          "backgroundColor" : "#FFFFFF",
          "cellSpacingX" : 0,
          "cellSpacingY" : 0,
          "fit" : "original",
          "gutterColor" : "#C5D3E0"
        },
        "version" : 1.0
      }
    ],
    "layouts" : [ ],
    "steps" : {
      "CSAT___Single_Custom_1" : {
        "broadcastFacet" : true,
        "groups" : [ ],
        "label" : "CSAT - Single Customer Journey Vs Average Ratings",
        "numbers" : [ ],
        "query" : "config = load \"${App.Datasets.Journey_Survey_Question_Config_Metadata.FullyQualifiedName}\";config = filter config by 'Context' == \"Customer CSAT\";\nconfig = filter config by 'QuestionType' == \"Rating\"; config = filter config by {{cell(CSAT___Customer_Journey_1.selection,0,\"JourneyConfig_Journey\").asEquality(\"Journey\")}}; q = load \"${App.Datasets.SurveyQuestionResponsewithDetails.FullyQualifiedName}\";q = filter q by {{cell(CSAT___Customer_Journey_1.selection,0,\"JourneyConfig_Journey\").asEquality(\"JourneyConfig_Journey\")}}; q = filter q by 'Question_QuestionType' == \"Rating\"; q = filter q by {{row(Response_date_filter_1.selection, [0], [\"min\", \"max\"]).asDateRange(\"date(CreatedDate_Year, CreatedDate_Month, CreatedDate_Day)\")}};\nq_cust = filter q by {{cell(Selected_Contact_1.selection, 0, \"Id\").asEquality(\"Invitation_ParticipantId\")}};\nq = group q by ('Id', 'SurveyVersion_Survey_Id', 'SurveyVersionId', 'QuestionId', 'QuestionChoices_Name', 'JourneyConfig_Stage');\nq = foreach q generate 'Id' , 'SurveyVersion_Survey_Id', 'SurveyVersionId', 'QuestionId', 'QuestionChoices_Name' as 'QuestionChoices_Name', 'JourneyConfig_Stage', first('CreatedDate_sec_epoch') as 'CreatedDate_sec_epoch',  first('NumberValue') as 'NumberValue';\nq = order q by ('SurveyVersion_Survey_Id' asc, 'SurveyVersionId' asc, 'QuestionId' asc, 'QuestionChoices_Name' asc);\nq = group q by ('Id', 'SurveyVersion_Survey_Id', 'SurveyVersionId', 'QuestionId', 'JourneyConfig_Stage');\nq = foreach q generate 'Id' , 'SurveyVersion_Survey_Id', 'SurveyVersionId', 'QuestionId', 'JourneyConfig_Stage', string_to_number(last('QuestionChoices_Name')) as 'Max Rating', round(first('NumberValue')/string_to_number(last('QuestionChoices_Name')),4) as 'Rating%',  first('NumberValue') as 'NumberValue';\n\nq_cust = group q_cust by ('Id', 'SurveyVersion_Survey_Id', 'SurveyVersionId', 'QuestionId', 'QuestionChoices_Name', 'JourneyConfig_Stage');\nq_cust = foreach q_cust generate 'Id' , 'SurveyVersion_Survey_Id', 'SurveyVersionId', 'QuestionId', 'QuestionChoices_Name' as 'QuestionChoices_Name', 'JourneyConfig_Stage', first('CreatedDate_sec_epoch') as 'CreatedDate_sec_epoch',  first('NumberValue') as 'NumberValue';\nq_cust = order q_cust by ('SurveyVersion_Survey_Id' asc, 'SurveyVersionId' asc, 'QuestionId' asc, 'QuestionChoices_Name' asc);\nq_cust = group q_cust by ('Id', 'SurveyVersion_Survey_Id', 'SurveyVersionId', 'QuestionId', 'JourneyConfig_Stage');\nq_cust = foreach q_cust generate 'Id' , 'SurveyVersion_Survey_Id', 'SurveyVersionId', 'QuestionId', 'JourneyConfig_Stage', string_to_number(last('QuestionChoices_Name')) as 'Max Rating', round(first('NumberValue')/string_to_number(last('QuestionChoices_Name')),4) as 'Rating%',  first('NumberValue') as 'NumberValue';\n\njourney = group config by ('Stage') left, q by ('JourneyConfig_Stage') left, q_cust by ('JourneyConfig_Stage');\njourney = foreach journey generate config.'Stage' as 'Stage', coalesce((sum(q.'Rating%') * first(config.'Scale'))/count(q),0) as 'Average Score', coalesce((sum(q_cust.'Rating%') * first(config.'Scale'))/count(q_cust),0) as 'Average Customer Score', first(config.'StageOrder') as 'StageOrder'; journey = order journey by 'StageOrder' asc;",
        "receiveFacetSource" : {
          "mode" : "none",
          "steps" : [ ]
        },
        "selectMode" : "single",
        "strings" : [ ],
        "type" : "saql",
        "useGlobal" : false,
        "visualizationParameters" : {
          "parameters" : {
            "autoFitMode" : "keepLabels",
            "showValues" : true,
            "stack" : false,
            "showPoints" : true,
            "legend" : {
              "descOrder" : false,
              "showHeader" : true,
              "show" : true,
              "customSize" : "auto",
              "position" : "right-top",
              "inside" : false
            },
            "axisMode" : "sync",
            "tooltip" : {
              "showBinLabel" : true,
              "measures" : "",
              "showNullValues" : true,
              "showPercentage" : true,
              "showDimensions" : true,
              "showMeasures" : true,
              "customizeTooltip" : false,
              "dimensions" : ""
            },
            "visualizationType" : "combo",
            "missingValue" : "connect",
            "showValuesOnLine" : false,
            "title" : {
              "fontSize" : 14,
              "subtitleFontSize" : 11,
              "label" : "",
              "align" : "center",
              "subtitleLabel" : ""
            },
            "trellis" : {
              "flipLabels" : false,
              "showGridLines" : true,
              "size" : [
                100,
                100
              ],
              "enable" : false,
              "type" : "x",
              "chartsPerLine" : 4
            },
            "columnMap" : {
              "trellis" : [ ],
              "dimensionAxis" : [
                "Stage"
              ],
              "plots" : [
                "Average Customer Score",
                "Average Score"
              ]
            },
            "showActionMenu" : true,
            "measureAxis2" : {
              "sqrtScale" : false,
              "showTitle" : true,
              "showAxis" : true,
              "title" : "",
              "customDomain" : {
                "showDomain" : false
              }
            },
            "measureAxis1" : {
              "sqrtScale" : false,
              "showTitle" : true,
              "showAxis" : true,
              "title" : "",
              "customDomain" : {
                "showDomain" : false
              }
            },
            "theme" : "wave",
            "dimensionAxis" : {
              "showTitle" : true,
              "customSize" : "auto",
              "showAxis" : true,
              "title" : "",
              "icons" : {
                "useIcons" : false,
                "iconProps" : {
                  "fit" : "cover",
                  "column" : "",
                  "type" : "round"
                }
              }
            },
            "applyConditionalFormatting" : true
          },
          "type" : "chart"
        }
      },
      "Selected_Contact_1" : {
        "broadcastFacet" : true,
        "datasets" : [
          {
            "name" : "${App.Datasets.Contacts.Name}"
          }
        ],
        "isGlobal" : false,
        "label" : "Selected Contact",
        "query" : {
          "query" : {
            "measures" : [
              [
                "count",
                "*"
              ]
            ],
            "groups" : [
              "Id"
            ]
          },
          "version" : -1.0
        },
        "receiveFacetSource" : {
          "mode" : "all",
          "steps" : [ ]
        },
        "selectMode" : "singlerequired",
        "type" : "aggregateflex",
        "useGlobal" : true,
        "visualizationParameters" : {
          "parameters" : {
            "autoFitMode" : "keepLabels",
            "showValues" : true,
            "bins" : {
              "breakpoints" : {
                "high" : 100,
                "low" : 0
              },
              "bands" : {
                "high" : {
                  "color" : "#008000",
                  "label" : ""
                },
                "low" : {
                  "color" : "#B22222",
                  "label" : ""
                },
                "medium" : {
                  "color" : "#ffa500",
                  "label" : ""
                }
              }
            },
            "legend" : {
              "descOrder" : false,
              "showHeader" : true,
              "show" : true,
              "customSize" : "auto",
              "position" : "right-top",
              "inside" : false
            },
            "axisMode" : "multi",
            "tooltip" : {
              "showBinLabel" : true,
              "measures" : "",
              "showNullValues" : true,
              "showPercentage" : true,
              "showDimensions" : true,
              "showMeasures" : true,
              "customizeTooltip" : false,
              "dimensions" : ""
            },
            "visualizationType" : "hbar",
            "title" : {
              "fontSize" : 14,
              "subtitleFontSize" : 11,
              "label" : "",
              "align" : "center",
              "subtitleLabel" : ""
            },
            "binValues" : false,
            "trellis" : {
              "flipLabels" : false,
              "showGridLines" : true,
              "size" : [
                100,
                100
              ],
              "enable" : false,
              "type" : "x",
              "chartsPerLine" : 4
            },
            "columnMap" : {
              "trellis" : [ ],
              "dimensionAxis" : [
                "Id"
              ],
              "plots" : [
                "count"
              ]
            },
            "showActionMenu" : true,
            "measureAxis2" : {
              "sqrtScale" : false,
              "showTitle" : true,
              "showAxis" : true,
              "title" : "",
              "customDomain" : {
                "showDomain" : false
              }
            },
            "measureAxis1" : {
              "sqrtScale" : false,
              "showTitle" : true,
              "showAxis" : true,
              "title" : "",
              "customDomain" : {
                "showDomain" : false
              }
            },
            "theme" : "wave",
            "dimensionAxis" : {
              "showTitle" : true,
              "customSize" : "auto",
              "showAxis" : true,
              "title" : "",
              "icons" : {
                "useIcons" : false,
                "iconProps" : {
                  "fit" : "cover",
                  "column" : "",
                  "type" : "round"
                }
              }
            },
            "applyConditionalFormatting" : true
          },
          "type" : "chart"
        }
      },
      "CSAT___Customer_Journey_1" : {
        "broadcastFacet" : true,
        "datasets" : [
          {
            "name" : "${App.Datasets.SurveyQuestionResponsewithDetails.Name}"
          }
        ],
        "isGlobal" : false,
        "label" : "CSAT - Customer Journey List",
        "query" : {
          "query" : {
            "measures" : [
              [
                "count",
                "*"
              ]
            ],
            "groups" : [
              "JourneyConfig_Journey"
            ],
            "filters" : [
              [
                "Question_QuestionType",
                [
                  "Rating"
                ],
                "in"
              ],
              [
                "JourneyConfig_Context",
                [
                  "Customer CSAT"
                ],
                "in"
              ]
            ]
          },
          "version" : -1.0
        },
        "receiveFacetSource" : {
          "mode" : "none",
          "steps" : [ ]
        },
        "selectMode" : "singlerequired",
        "type" : "aggregateflex",
        "useGlobal" : true,
        "visualizationParameters" : {
          "parameters" : {
            "autoFitMode" : "keepLabels",
            "showValues" : true,
            "bins" : {
              "breakpoints" : {
                "high" : 100,
                "low" : 0
              },
              "bands" : {
                "high" : {
                  "color" : "#008000",
                  "label" : ""
                },
                "low" : {
                  "color" : "#B22222",
                  "label" : ""
                },
                "medium" : {
                  "color" : "#ffa500",
                  "label" : ""
                }
              }
            },
            "legend" : {
              "descOrder" : false,
              "showHeader" : true,
              "show" : true,
              "customSize" : "auto",
              "position" : "right-top",
              "inside" : false
            },
            "axisMode" : "multi",
            "tooltip" : {
              "showBinLabel" : true,
              "measures" : "",
              "showNullValues" : true,
              "showPercentage" : true,
              "showDimensions" : true,
              "showMeasures" : true,
              "customizeTooltip" : false,
              "dimensions" : ""
            },
            "visualizationType" : "hbar",
            "title" : {
              "fontSize" : 14,
              "subtitleFontSize" : 11,
              "label" : "",
              "align" : "center",
              "subtitleLabel" : ""
            },
            "binValues" : false,
            "trellis" : {
              "flipLabels" : false,
              "showGridLines" : true,
              "size" : [
                100,
                100
              ],
              "enable" : false,
              "type" : "x",
              "chartsPerLine" : 4
            },
            "columnMap" : {
              "trellis" : [ ],
              "dimensionAxis" : [
                "JourneyConfig_Journey"
              ],
              "plots" : [
                "count"
              ]
            },
            "showActionMenu" : true,
            "measureAxis2" : {
              "sqrtScale" : false,
              "showTitle" : true,
              "showAxis" : true,
              "title" : "",
              "customDomain" : {
                "showDomain" : false
              }
            },
            "measureAxis1" : {
              "sqrtScale" : false,
              "showTitle" : true,
              "showAxis" : true,
              "title" : "",
              "customDomain" : {
                "showDomain" : false
              }
            },
            "theme" : "wave",
            "dimensionAxis" : {
              "showTitle" : true,
              "customSize" : "auto",
              "showAxis" : true,
              "title" : "",
              "icons" : {
                "useIcons" : false,
                "iconProps" : {
                  "fit" : "cover",
                  "column" : "",
                  "type" : "round"
                }
              }
            },
            "applyConditionalFormatting" : true
          },
          "type" : "chart"
        }
      },
      "CSAT___Customer_Jour_3" : {
        "broadcastFacet" : true,
        "groups" : [ ],
        "label" : "CSAT - Customer Journey Latest Rating",
        "numbers" : [ ],
        "query" : "config = load \"${App.Datasets.Journey_Survey_Question_Config_Metadata.FullyQualifiedName}\";\nconfig = filter config by 'Context' == \"Customer CSAT\";\nconfig = filter config by 'QuestionType' == \"Rating\";\nq = load \"${App.Datasets.SurveyQuestionResponsewithDetails.FullyQualifiedName}\";\nq = filter q by 'Question_QuestionType' == \"Rating\";\nq = filter q by {{cell(CSAT___Single_Custom_1.selection, 0, \"Stage\").asEquality(\"JourneyConfig_Stage\")}};\nq = group q by ('Id', 'SurveyVersion_Survey_Id', 'SurveyVersionId', 'QuestionId', 'JourneyConfig_Stage');\nq = foreach q generate 'Id' , 'SurveyVersion_Survey_Id', 'SurveyVersionId', 'QuestionId', 'JourneyConfig_Stage', first('CreatedDate_sec_epoch') as 'CreatedDate_sec_epoch',  first('NumberValue') as 'NumberValue';\nq = order q by ('CreatedDate_sec_epoch' desc);\njourney = group config by all left, q by all;\njourney = foreach journey generate  first(q.'NumberValue') as 'Rating', count(q) as 'Total Responses';",
        "receiveFacetSource" : {
          "mode" : "all",
          "steps" : [ ]
        },
        "selectMode" : "single",
        "strings" : [ ],
        "type" : "saql",
        "useGlobal" : true,
        "visualizationParameters" : {
          "parameters" : {
            "autoFitMode" : "keepLabels",
            "showValues" : true,
            "bins" : {
              "breakpoints" : {
                "high" : 100,
                "low" : 0
              },
              "bands" : {
                "high" : {
                  "color" : "#008000",
                  "label" : ""
                },
                "low" : {
                  "color" : "#B22222",
                  "label" : ""
                },
                "medium" : {
                  "color" : "#ffa500",
                  "label" : ""
                }
              }
            },
            "legend" : {
              "descOrder" : false,
              "showHeader" : true,
              "show" : true,
              "customSize" : "auto",
              "position" : "right-top",
              "inside" : false
            },
            "axisMode" : "multi",
            "tooltip" : {
              "showBinLabel" : true,
              "measures" : "",
              "showNullValues" : true,
              "showPercentage" : true,
              "showDimensions" : true,
              "showMeasures" : true,
              "customizeTooltip" : false,
              "dimensions" : ""
            },
            "visualizationType" : "hbar",
            "title" : {
              "fontSize" : 14,
              "subtitleFontSize" : 11,
              "label" : "",
              "align" : "center",
              "subtitleLabel" : ""
            },
            "binValues" : false,
            "trellis" : {
              "flipLabels" : false,
              "showGridLines" : true,
              "size" : [
                100,
                100
              ],
              "enable" : false,
              "type" : "x",
              "chartsPerLine" : 4
            },
            "showActionMenu" : true,
            "measureAxis2" : {
              "sqrtScale" : false,
              "showTitle" : true,
              "showAxis" : true,
              "title" : "",
              "customDomain" : {
                "showDomain" : false
              }
            },
            "measureAxis1" : {
              "sqrtScale" : false,
              "showTitle" : true,
              "showAxis" : true,
              "title" : "",
              "customDomain" : {
                "showDomain" : false
              }
            },
            "theme" : "wave",
            "dimensionAxis" : {
              "showTitle" : true,
              "customSize" : "auto",
              "showAxis" : true,
              "title" : "",
              "icons" : {
                "useIcons" : false,
                "iconProps" : {
                  "fit" : "cover",
                  "column" : "",
                  "type" : "round"
                }
              }
            },
            "applyConditionalFormatting" : true
          },
          "type" : "chart"
        }
      },
      "CSAT___Customer_Jour_2" : {
        "broadcastFacet" : true,
        "groups" : [ ],
        "label" : "CSAT - Customer Journey KPI",
        "numbers" : [ ],
        "query" : "\nconfig = load \"${App.Datasets.Journey_Survey_Question_Config_Metadata.FullyQualifiedName}\";\nconfig = filter config by 'Context' == \"Customer CSAT\"; \nconfig = filter config by 'QuestionType' == \"Rating\";\n\nq = load \"${App.Datasets.SurveyQuestionResponsewithDetails.FullyQualifiedName}\"; q = filter q by {{cell(CSAT___Single_Custom_1.selection, 0, \"Stage\").asEquality(\"JourneyConfig_Stage\")}}; \nq = filter q by 'Question_QuestionType' == \"Rating\";\nq = group q by ('Id', 'SurveyVersion_Survey_Id', 'SurveyVersionId', 'QuestionId', 'QuestionChoices_Name', 'JourneyConfig_Stage'); \nq = foreach q generate 'Id' , 'SurveyVersion_Survey_Id', 'SurveyVersionId', 'QuestionId', 'QuestionChoices_Name' as 'QuestionChoices_Name', 'JourneyConfig_Stage', first('CreatedDate_sec_epoch') as 'CreatedDate_sec_epoch',  first('NumberValue') as 'NumberValue'; \nq = order q by ('SurveyVersion_Survey_Id' asc, 'SurveyVersionId' asc, 'QuestionId' asc, 'QuestionChoices_Name' asc); \nq = group q by ('Id', 'SurveyVersion_Survey_Id', 'SurveyVersionId', 'QuestionId', 'JourneyConfig_Stage'); \nq = foreach q generate 'Id' , 'SurveyVersion_Survey_Id', 'SurveyVersionId', 'QuestionId', 'JourneyConfig_Stage', string_to_number(last('QuestionChoices_Name')) as 'Max Rating', round(first('NumberValue')/string_to_number(last('QuestionChoices_Name')),4) as 'Rating%',  first('NumberValue') as 'NumberValue'; \n\n\njourney = group config by all left, q by all;\njourney = foreach journey generate round((sum(q.'Rating%') * first(config.'Scale'))/count(q),2) as 'CSAT', count(q) as 'Total Responses';",
        "receiveFacetSource" : {
          "mode" : "all",
          "steps" : [ ]
        },
        "selectMode" : "single",
        "strings" : [ ],
        "type" : "saql",
        "useGlobal" : true,
        "visualizationParameters" : {
          "parameters" : {
            "autoFitMode" : "keepLabels",
            "showValues" : true,
            "bins" : {
              "breakpoints" : {
                "high" : 100,
                "low" : 0
              },
              "bands" : {
                "high" : {
                  "color" : "#008000",
                  "label" : ""
                },
                "low" : {
                  "color" : "#B22222",
                  "label" : ""
                },
                "medium" : {
                  "color" : "#ffa500",
                  "label" : ""
                }
              }
            },
            "legend" : {
              "descOrder" : false,
              "showHeader" : true,
              "show" : true,
              "customSize" : "auto",
              "position" : "right-top",
              "inside" : false
            },
            "axisMode" : "multi",
            "tooltip" : {
              "showBinLabel" : true,
              "measures" : "",
              "showNullValues" : true,
              "showPercentage" : true,
              "showDimensions" : true,
              "showMeasures" : true,
              "customizeTooltip" : false,
              "dimensions" : ""
            },
            "visualizationType" : "hbar",
            "title" : {
              "fontSize" : 14,
              "subtitleFontSize" : 11,
              "label" : "",
              "align" : "center",
              "subtitleLabel" : ""
            },
            "binValues" : false,
            "trellis" : {
              "flipLabels" : false,
              "showGridLines" : true,
              "size" : [
                100,
                100
              ],
              "enable" : false,
              "type" : "x",
              "chartsPerLine" : 4
            },
            "showActionMenu" : true,
            "measureAxis2" : {
              "sqrtScale" : false,
              "showTitle" : true,
              "showAxis" : true,
              "title" : "",
              "customDomain" : {
                "showDomain" : false
              }
            },
            "measureAxis1" : {
              "sqrtScale" : false,
              "showTitle" : true,
              "showAxis" : true,
              "title" : "",
              "customDomain" : {
                "showDomain" : false
              }
            },
            "theme" : "wave",
            "dimensionAxis" : {
              "showTitle" : true,
              "customSize" : "auto",
              "showAxis" : true,
              "title" : "",
              "icons" : {
                "useIcons" : false,
                "iconProps" : {
                  "fit" : "cover",
                  "column" : "",
                  "type" : "round"
                }
              }
            },
            "applyConditionalFormatting" : true
          },
          "type" : "chart"
        }
      },
      "Response_date_filter_1" : {
        "broadcastFacet" : true,
        "datasets" : [
          {
            "name" : "${App.Datasets.SurveyQuestionResponsewithDetails.Name}"
          }
        ],
        "isGlobal" : false,
        "label" : "Response date filter",
        "query" : {
          "query" : {
            "measures" : [
              [
                "count",
                "*"
              ]
            ],
            "groups" : [
              [
                "CreatedDate_Year",
                "CreatedDate_Month",
                "CreatedDate_Day"
              ]
            ]
          },
          "version" : -1.0
        },
        "receiveFacetSource" : {
          "mode" : "none",
          "steps" : [ ]
        },
        "selectMode" : "single",
        "type" : "aggregateflex",
        "useGlobal" : true,
        "visualizationParameters" : {
          "parameters" : {
            "autoFitMode" : "keepLabels",
            "showValues" : true,
            "bins" : {
              "breakpoints" : {
                "high" : 100,
                "low" : 0
              },
              "bands" : {
                "high" : {
                  "color" : "#008000",
                  "label" : ""
                },
                "low" : {
                  "color" : "#B22222",
                  "label" : ""
                },
                "medium" : {
                  "color" : "#ffa500",
                  "label" : ""
                }
              }
            },
            "legend" : {
              "descOrder" : false,
              "showHeader" : true,
              "show" : true,
              "customSize" : "auto",
              "position" : "right-top",
              "inside" : false
            },
            "axisMode" : "multi",
            "tooltip" : {
              "showBinLabel" : true,
              "measures" : "",
              "showNullValues" : true,
              "showPercentage" : true,
              "showDimensions" : true,
              "showMeasures" : true,
              "customizeTooltip" : false,
              "dimensions" : ""
            },
            "visualizationType" : "hbar",
            "title" : {
              "fontSize" : 14,
              "subtitleFontSize" : 11,
              "label" : "",
              "align" : "center",
              "subtitleLabel" : ""
            },
            "binValues" : false,
            "trellis" : {
              "flipLabels" : false,
              "showGridLines" : true,
              "size" : [
                100,
                100
              ],
              "enable" : false,
              "type" : "x",
              "chartsPerLine" : 4
            },
            "columnMap" : {
              "trellis" : [ ],
              "dimensionAxis" : [
                "CreatedDate_Year~~~CreatedDate_Month~~~CreatedDate_Day"
              ],
              "plots" : [
                "count"
              ]
            },
            "showActionMenu" : true,
            "measureAxis2" : {
              "sqrtScale" : false,
              "showTitle" : true,
              "showAxis" : true,
              "title" : "",
              "customDomain" : {
                "showDomain" : false
              }
            },
            "measureAxis1" : {
              "sqrtScale" : false,
              "showTitle" : true,
              "showAxis" : true,
              "title" : "",
              "customDomain" : {
                "showDomain" : false
              }
            },
            "theme" : "wave",
            "dimensionAxis" : {
              "showTitle" : true,
              "customSize" : "auto",
              "showAxis" : true,
              "title" : "",
              "icons" : {
                "useIcons" : false,
                "iconProps" : {
                  "fit" : "cover",
                  "column" : "",
                  "type" : "round"
                }
              }
            },
            "applyConditionalFormatting" : true
          },
          "type" : "chart"
        }
      }
    },
    "widgetStyle" : {
      "backgroundColor" : "#FFFFFF",
      "borderColor" : "#E6ECF2",
      "borderEdges" : [ ],
      "borderRadius" : 0,
      "borderWidth" : 1
    },
    "widgets" : {
      "dateselector_1" : {
        "parameters" : {
          "absoluteModeEnabled" : true,
          "calendarTypeSwitchingAllowed" : true,
          "defaultFiscalMode" : false,
          "displayMode" : "filter",
          "filterStyle" : {
            "titleColor" : "#54698D",
            "valueColor" : "#16325C"
          },
          "instant" : false,
          "presetsEnabled" : true,
          "relativeModeEnabled" : true,
          "showActionMenu" : false,
          "step" : "Response_date_filter_1",
          "title" : ""
        },
        "type" : "dateselector"
      },
      "number_3" : {
        "parameters" : {
          "compact" : true,
          "exploreLink" : true,
          "measureField" : "Total Responses",
          "noResultsLabel" : "-",
          "numberColor" : "#091A3E",
          "numberSize" : 24,
          "showActionMenu" : true,
          "step" : "CSAT___Customer_Jour_2",
          "textAlignment" : "left",
          "title" : "",
          "titleColor" : "#091A3E",
          "titleSize" : 16
        },
        "type" : "number"
      },
      "container_1" : {
        "parameters" : {
          "alignmentX" : "left",
          "alignmentY" : "top",
          "fit" : "original"
        },
        "type" : "container"
      },
      "number_2" : {
        "parameters" : {
          "compact" : false,
          "exploreLink" : true,
          "measureField" : "CSAT",
          "noResultsLabel" : "-",
          "numberColor" : "#091A3E",
          "numberSize" : 24,
          "showActionMenu" : true,
          "step" : "CSAT___Customer_Jour_2",
          "textAlignment" : "left",
          "title" : "",
          "titleColor" : "#091A3E",
          "titleSize" : 16
        },
        "type" : "number"
      },
      "number_1" : {
        "parameters" : {
          "compact" : false,
          "exploreLink" : true,
          "measureField" : "Rating",
          "numberColor" : "#091A3E",
          "numberSize" : 24,
          "showActionMenu" : true,
          "step" : "CSAT___Customer_Jour_3",
          "textAlignment" : "left",
          "title" : "",
          "titleColor" : "#091A3E",
          "titleSize" : 16
        },
        "type" : "number"
      },
      "text_3" : {
        "parameters" : {
          "content" : {
            "displayTemplate" : "Customer Journey"
          },
          "fontSize" : 14,
          "showActionMenu" : true,
          "textAlignment" : "right",
          "textColor" : "#091A3E"
        },
        "type" : "text"
      },
      "text_2" : {
        "parameters" : {
          "content" : {
            "displayTemplate" : "Which stage of the customer’s journey needs attention?"
          },
          "fontSize" : 20,
          "showActionMenu" : true,
          "textAlignment" : "left",
          "textColor" : "#091A3E"
        },
        "type" : "text"
      },
      "text_5" : {
        "parameters" : {
          "content" : {
            "displayTemplate" : "CURRENT CSAT SCORE"
          },
          "fontSize" : 14,
          "showActionMenu" : true,
          "textAlignment" : "left",
          "textColor" : "#091A3E"
        },
        "type" : "text"
      },
      "listselector_1" : {
        "parameters" : {
          "compact" : false,
          "displayMode" : "filter",
          "exploreLink" : false,
          "filterStyle" : {
            "titleColor" : "#54698D",
            "valueColor" : "#16325C"
          },
          "instant" : true,
          "measureField" : "none",
          "showActionMenu" : false,
          "step" : "CSAT___Customer_Journey_1",
          "title" : ""
        },
        "type" : "listselector"
      },
      "text_4" : {
        "parameters" : {
          "content" : {
            "displayTemplate" : "Response Period"
          },
          "fontSize" : 14,
          "showActionMenu" : true,
          "textAlignment" : "right",
          "textColor" : "#091A3E"
        },
        "type" : "text"
      },
      "text_7" : {
        "parameters" : {
          "content" : {
            "displayTemplate" : "AVERAGE CSAT SCORE"
          },
          "fontSize" : 14,
          "showActionMenu" : true,
          "textAlignment" : "left",
          "textColor" : "#091A3E"
        },
        "type" : "text"
      },
      "text_6" : {
        "parameters" : {
          "content" : {
            "displayTemplate" : "TOTAL RESPONSES"
          },
          "fontSize" : 14,
          "showActionMenu" : true,
          "textAlignment" : "left",
          "textColor" : "#091A3E"
        },
        "type" : "text"
      },
      "chart_3" : {
        "parameters" : {
          "autoFitMode" : "keepLabels",
          "showValues" : true,
          "stack" : false,
          "showPoints" : true,
          "legend" : {
            "descOrder" : false,
            "showHeader" : true,
            "show" : true,
            "customSize" : "auto",
            "position" : "right-top",
            "inside" : false
          },
          "axisMode" : "sync",
          "tooltip" : {
            "showBinLabel" : true,
            "measures" : "",
            "showNullValues" : true,
            "showPercentage" : true,
            "showDimensions" : true,
            "showMeasures" : true,
            "customizeTooltip" : false,
            "dimensions" : ""
          },
          "visualizationType" : "combo",
          "missingValue" : "connect",
          "showValuesOnLine" : false,
          "exploreLink" : true,
          "title" : {
            "fontSize" : 14,
            "subtitleFontSize" : 11,
            "label" : "",
            "align" : "center",
            "subtitleLabel" : ""
          },
          "trellis" : {
            "flipLabels" : false,
            "showGridLines" : true,
            "size" : [
              100,
              100
            ],
            "enable" : false,
            "type" : "x",
            "parameters" : { },
            "chartsPerLine" : 4
          },
          "columnMap" : {
            "trellis" : [ ],
            "dimensionAxis" : [
              "Stage"
            ],
            "plots" : [
              "Average Customer Score",
              "Average Score"
            ]
          },
          "showActionMenu" : true,
          "measureAxis2" : {
            "sqrtScale" : false,
            "showTitle" : true,
            "showAxis" : true,
            "title" : "",
            "customDomain" : {
              "showDomain" : false
            }
          },
          "measureAxis1" : {
            "sqrtScale" : false,
            "showTitle" : false,
            "showAxis" : true,
            "title" : "",
            "customDomain" : {
              "high" : 10,
              "low" : 0,
              "showDomain" : true
            }
          },
          "theme" : "light",
          "step" : "CSAT___Single_Custom_1",
          "dimensionAxis" : {
            "showTitle" : true,
            "customSize" : "auto",
            "showAxis" : true,
            "title" : "",
            "icons" : {
              "useIcons" : false,
              "iconProps" : {
                "fit" : "cover",
                "column" : "",
                "type" : "round",
                "parameters" : { }
              }
            }
          },
          "applyConditionalFormatting" : true
        },
        "type" : "chart"
      }
    }
  }
}