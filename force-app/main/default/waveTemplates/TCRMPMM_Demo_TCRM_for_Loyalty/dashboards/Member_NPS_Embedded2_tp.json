{
  "name" : "Member_NPS_Embedded2_tp",
  "label" : "1Member NPS Embedded",
  "folder" : {
    "id" : "${App.Folder.Id}"
  },
  "dateVersion" : 1,
  "mobileDisabled" : false,
  "xmd" : {
    "measures" : [ ],
    "derivedDimensions" : [ ],
    "organizations" : [ ],
    "showDetailsDefaultFields" : [ ],
    "dates" : [ ],
    "derivedMeasures" : [ ],
    "dimensions" : [ ]
  },
  "state" : {
    "dataSourceLinks" : [
      {
        "fields" : [
          {
            "dataSourceName" : "${App.Datasets.LoyaltyMemberTier7.Name}",
            "dataSourceNamespace" : "${Org.Namespace}",
            "dataSourceType" : "dataset",
            "fieldName" : "LoyaltyMemberId"
          },
          {
            "dataSourceName" : "${App.Datasets.SurveyQuestionResponse2.Name}",
            "dataSourceNamespace" : "${Org.Namespace}",
            "dataSourceType" : "dataset",
            "fieldName" : "SurveySubject_Participant_LoyaltyMemberId"
          }
        ],
        "label" : "Program Member",
        "name" : "Link_589"
      }
    ],
    "filters" : [
      {
        "dataset" : {
          "name" : "${App.Datasets.SurveyQuestionResponse2.Name}"
        },
        "dependent" : true,
        "fields" : [
          "SurveyResponse_CompletionDateTime"
        ],
        "label" : " Duration",
        "locked" : false,
        "operator" : ">=<=",
        "value" : "[[[\"year\",0],[\"year\",0]]]"
      }
    ],
    "gridLayouts" : [
      {
        "maxWidth" : 850,
        "name" : "Default",
        "numColumns" : 50,
        "pages" : [
          {
            "label" : "Untitled",
            "name" : "ead2ea45-1572-47ef-b0bf-cc3694e936f3",
            "navigationHidden" : false,
            "widgets" : [
              {
                "colspan" : 22,
                "column" : 6,
                "name" : "text_1",
                "row" : 1,
                "rowspan" : 4,
                "widgetStyle" : {
                  "borderEdges" : [ ]
                }
              },
              {
                "colspan" : 4,
                "column" : 2,
                "name" : "image_1",
                "row" : 1,
                "rowspan" : 4,
                "widgetStyle" : {
                  "backgroundColor" : "#FFFFFF",
                  "borderColor" : "rgba(230, 236, 242, 0)",
                  "borderEdges" : [
                    "top",
                    "bottom"
                  ],
                  "borderRadius" : 0,
                  "borderWidth" : 2
                }
              },
              {
                "colspan" : 17,
                "column" : 31,
                "name" : "filterpanel_1",
                "row" : 1,
                "rowspan" : 4,
                "widgetStyle" : {
                  "backgroundColor" : "#FFFFFF",
                  "borderColor" : "#E6ECF2",
                  "borderEdges" : [
                    "all"
                  ],
                  "borderRadius" : 4,
                  "borderWidth" : 1
                }
              },
              {
                "colspan" : 23,
                "column" : 2,
                "name" : "container_1",
                "row" : 6,
                "rowspan" : 13,
                "widgetStyle" : {
                  "backgroundColor" : "#4269E9",
                  "borderColor" : "#E6ECF2",
                  "borderEdges" : [ ],
                  "borderRadius" : 0,
                  "borderWidth" : 1
                }
              },
              {
                "colspan" : 23,
                "column" : 25,
                "name" : "container_2",
                "row" : 6,
                "rowspan" : 13,
                "widgetStyle" : {
                  "backgroundColor" : "#E6ECF2",
                  "borderColor" : "#E6ECF2",
                  "borderEdges" : [ ],
                  "borderRadius" : 0,
                  "borderWidth" : 1
                }
              },
              {
                "colspan" : 21,
                "column" : 3,
                "name" : "text_3",
                "row" : 7,
                "rowspan" : 4,
                "widgetStyle" : {
                  "backgroundColor" : "rgba(255, 255, 255, 0)",
                  "borderColor" : "#E6ECF2",
                  "borderEdges" : [ ],
                  "borderRadius" : 0,
                  "borderWidth" : 1
                }
              },
              {
                "colspan" : 21,
                "column" : 3,
                "name" : "number_1",
                "row" : 11,
                "rowspan" : 3,
                "widgetStyle" : {
                  "backgroundColor" : "rgba(255, 255, 255, 0)",
                  "borderColor" : "#E6ECF2",
                  "borderEdges" : [ ],
                  "borderRadius" : 0,
                  "borderWidth" : 1
                }
              },
              {
                "colspan" : 21,
                "column" : 26,
                "name" : "text_4",
                "row" : 7,
                "rowspan" : 4,
                "widgetStyle" : {
                  "backgroundColor" : "rgba(255, 255, 255, 0)",
                  "borderColor" : "#E6ECF2",
                  "borderEdges" : [ ],
                  "borderRadius" : 0,
                  "borderWidth" : 1
                }
              },
              {
                "colspan" : 21,
                "column" : 26,
                "name" : "number_2",
                "row" : 11,
                "rowspan" : 3,
                "widgetStyle" : {
                  "backgroundColor" : "rgba(255, 255, 255, 0)",
                  "borderColor" : "#E6ECF2",
                  "borderEdges" : [ ],
                  "borderRadius" : 0,
                  "borderWidth" : 1
                }
              },
              {
                "colspan" : 21,
                "column" : 26,
                "name" : "text_5",
                "row" : 15,
                "rowspan" : 3,
                "widgetStyle" : {
                  "backgroundColor" : "rgba(255, 255, 255, 0)",
                  "borderColor" : "#E6ECF2",
                  "borderEdges" : [ ],
                  "borderRadius" : 0,
                  "borderWidth" : 1
                }
              },
              {
                "colspan" : 12,
                "column" : 2,
                "name" : "image_2",
                "row" : 20,
                "rowspan" : 2,
                "widgetStyle" : {
                  "borderEdges" : [ ]
                }
              },
              {
                "colspan" : 21,
                "column" : 3,
                "name" : "text_6",
                "row" : 15,
                "rowspan" : 3,
                "widgetStyle" : {
                  "backgroundColor" : "rgba(255, 255, 255, 0)",
                  "borderColor" : "#E6ECF2",
                  "borderEdges" : [ ],
                  "borderRadius" : 0,
                  "borderWidth" : 1
                }
              }
            ]
          }
        ],
        "rowHeight" : "fine",
        "selectors" : [ ],
        "style" : {
          "alignmentX" : "left",
          "alignmentY" : "top",
          "backgroundColor" : "#FFFFFF",
          "cellSpacingX" : 0,
          "cellSpacingY" : 0,
          "fit" : "original",
          "gutterColor" : "#E6ECF2"
        },
        "version" : 1.0
      }
    ],
    "layouts" : [ ],
    "steps" : {
      "NPS_KPIs_1" : {
        "broadcastFacet" : true,
        "groups" : [ ],
        "label" : "NPS_KPIs",
        "numbers" : [ ],
        "query" : "q = load \"${App.Datasets.SurveyQuestionResponse2.FullyQualifiedName}\";\nq = filter q by 'SurveySubject_SubjectId' == \"{{cell(Member_1.result, 0, \"LoyaltyProgramMember_ProgramId\").asString()}}\";\nPromoters = filter q by 'NPS_Response_Bucket' == \"Promoters\";\nDetractors = filter q by 'NPS_Response_Bucket' == \"Detractors\";\nresult = group q by 'SurveySubject_Participant_LoyaltyMemberId' full, Promoters by 'SurveySubject_Participant_LoyaltyMemberId' full, Detractors by 'SurveySubject_Participant_LoyaltyMemberId';\nresult = foreach result generate coalesce(q.'SurveySubject_Participant_LoyaltyMemberId', Promoters.'SurveySubject_Participant_LoyaltyMemberId', Detractors.'SurveySubject_Participant_LoyaltyMemberId') as 'SurveySubject_Participant_LoyaltyMemberId', count(q) as 'Responses', count(Promoters) as 'Promoters', count(Detractors) as 'Detractors', sum(count(q)) over ([..] partition by all) as 'Overall_Responses', sum(count('Promoters')) over ([..] partition by all) as 'Overall_Promoters', sum(count('Detractors')) over ([..] partition by all) as 'Overall_Detractors';\nresult = filter result by 'SurveySubject_Participant_LoyaltyMemberId' == \"{{cell(Member_1.result, 0, \"LoyaltyMemberId\").asString()}}\";\nresult = foreach result generate 'SurveySubject_Participant_LoyaltyMemberId', coalesce(('Promoters' - 'Detractors') / 'Responses',0) as 'Member_NPS', coalesce(('Overall_Promoters' - 'Overall_Detractors') / 'Overall_Responses',0) as 'Overall_NPS';",
        "receiveFacetSource" : {
          "mode" : "none",
          "steps" : [ ]
        },
        "selectMode" : "single",
        "strings" : [ ],
        "type" : "saql",
        "useGlobal" : true,
        "visualizationParameters" : {
          "parameters" : {
            "borderColor" : "#e0e5ee",
            "borderWidth" : 1,
            "cell" : {
              "backgroundColor" : "#ffffff",
              "fontColor" : "#16325c",
              "fontSize" : 12
            },
            "columnProperties" : { },
            "columns" : [ ],
            "customBulkActions" : [ ],
            "header" : {
              "backgroundColor" : "#f4f6f9",
              "fontColor" : "#16325c",
              "fontSize" : 12
            },
            "innerMajorBorderColor" : "#a8b7c7",
            "innerMinorBorderColor" : "#e0e5ee",
            "maxColumnWidth" : 300,
            "minColumnWidth" : 40,
            "mode" : "variable",
            "numberOfLines" : 1,
            "showActionMenu" : true,
            "showRowIndexColumn" : false,
            "totals" : true,
            "verticalPadding" : 8
          },
          "type" : "table"
        }
      },
      "Latest_NPS_1" : {
        "broadcastFacet" : true,
        "groups" : [ ],
        "label" : "Latest_NPS",
        "numbers" : [ ],
        "query" : "q = load \"${App.Datasets.SurveyQuestionResponse2.FullyQualifiedName}\";\nq = filter q by 'SurveyQuestion_QuestionType' == \"NPS\";\nq = foreach q generate 'SurveyVersion_SurveyId', 'SurveyVersionId', 'QuestionId', 'SurveyResponse_CompletionDateTime', 'NumberValue';\nq = order q by ('SurveyResponse_CompletionDateTime' desc);\nresult = group q by ('SurveyVersion_SurveyId', 'SurveyVersionId', 'QuestionId');\nresult = foreach result generate q.'SurveyVersion_SurveyId' as 'SurveyVersion_SurveyId', q.'SurveyVersionId' as 'SurveyVersionId', q.'QuestionId' as 'QuestionId', first(q.'NumberValue') as 'Value', count(q) as 'count';",
        "receiveFacetSource" : {
          "mode" : "all",
          "steps" : [ ]
        },
        "selectMode" : "single",
        "start" : [ ],
        "strings" : [ ],
        "type" : "saql",
        "useGlobal" : true,
        "visualizationParameters" : {
          "parameters" : {
            "borderColor" : "#e0e5ee",
            "borderWidth" : 1,
            "cell" : {
              "backgroundColor" : "#ffffff",
              "fontColor" : "#16325c",
              "fontSize" : 12
            },
            "columnProperties" : { },
            "columns" : [ ],
            "customBulkActions" : [ ],
            "header" : {
              "backgroundColor" : "#f4f6f9",
              "fontColor" : "#16325c",
              "fontSize" : 12
            },
            "innerMajorBorderColor" : "#a8b7c7",
            "innerMinorBorderColor" : "#e0e5ee",
            "maxColumnWidth" : 300,
            "minColumnWidth" : 40,
            "mode" : "variable",
            "numberOfLines" : 1,
            "showActionMenu" : true,
            "showRowIndexColumn" : false,
            "totals" : true,
            "verticalPadding" : 8
          },
          "type" : "table"
        }
      },
      "Member_1" : {
        "broadcastFacet" : true,
        "datasets" : [
          {
            "name" : "${App.Datasets.LoyaltyMemberTier7.Name}"
          }
        ],
        "isGlobal" : false,
        "label" : "Member",
        "query" : {
          "query" : {
            "measures" : [
              [
                "count",
                "*",
                "A"
              ]
            ],
            "columns" : [
              {
                "query" : {
                  "measures" : [
                    [
                      "count",
                      "*"
                    ]
                  ],
                  "groups" : [
                    "LoyaltyMemberId",
                    "LoyaltyProgramMember_ProgramId"
                  ]
                }
              }
            ],
            "groups" : [
              "LoyaltyMemberId",
              "LoyaltyProgramMember_ProgramId"
            ]
          },
          "version" : -1.0
        },
        "receiveFacetSource" : {
          "mode" : "all",
          "steps" : [ ]
        },
        "selectMode" : "single",
        "start" : [ ],
        "type" : "aggregateflex",
        "useGlobal" : true,
        "visualizationParameters" : {
          "options" : { },
          "parameters" : {
            "borderColor" : "#e0e5ee",
            "borderWidth" : 1,
            "cell" : {
              "backgroundColor" : "#ffffff",
              "fontColor" : "#16325c",
              "fontSize" : 12
            },
            "columnProperties" : { },
            "columns" : [ ],
            "customBulkActions" : [ ],
            "header" : {
              "backgroundColor" : "#f4f6f9",
              "fontColor" : "#16325c",
              "fontSize" : 12
            },
            "innerMajorBorderColor" : "#a8b7c7",
            "innerMinorBorderColor" : "#e0e5ee",
            "maxColumnWidth" : 300,
            "minColumnWidth" : 40,
            "mode" : "variable",
            "numberOfLines" : 1,
            "showActionMenu" : true,
            "showRowIndexColumn" : false,
            "totals" : true,
            "verticalPadding" : 8
          },
          "type" : "table"
        }
      },
      "Overall_NPS_1" : {
        "broadcastFacet" : true,
        "groups" : [ ],
        "label" : "Overall NPS",
        "numbers" : [ ],
        "query" : "q = load \"${App.Datasets.SurveyQuestionResponse2.FullyQualifiedName}\";\nq = filter q by 'SurveyQuestion_QuestionType' == \"NPS\";\nq = filter q by 'SurveySubject_SubjectId' == \"{{cell(Member_1.result, 0, \"LoyaltyProgramMember_ProgramId\").asString()}}\";\nPromoters = filter q by 'NPS_Response_Bucket' == \"Promoters\";\nDetractors = filter q by 'NPS_Response_Bucket' == \"Detractors\";\nresult = group q by ('SurveyVersion_SurveyId', 'SurveyVersionId', 'QuestionId') left, Promoters by ('SurveyVersion_SurveyId', 'SurveyVersionId', 'QuestionId') full, Detractors by ('SurveyVersion_SurveyId', 'SurveyVersionId', 'QuestionId');\nresult = foreach result generate count(q) as 'Responses', count(Promoters) as 'Promoters', count(Detractors) as 'Detractors';\nresult = group result by all;\nresult = foreach result generate coalesce((sum('Promoters')-sum('Detractors'))/sum('Responses'),0)*100 as 'Overall_NPS';",
        "receiveFacetSource" : {
          "mode" : "none",
          "steps" : [ ]
        },
        "selectMode" : "single",
        "strings" : [ ],
        "type" : "saql",
        "useGlobal" : true,
        "visualizationParameters" : {
          "parameters" : {
            "borderColor" : "#e0e5ee",
            "borderWidth" : 1,
            "cell" : {
              "backgroundColor" : "#ffffff",
              "fontColor" : "#16325c",
              "fontSize" : 12
            },
            "columnProperties" : { },
            "columns" : [ ],
            "customBulkActions" : [ ],
            "header" : {
              "backgroundColor" : "#f4f6f9",
              "fontColor" : "#16325c",
              "fontSize" : 12
            },
            "innerMajorBorderColor" : "#a8b7c7",
            "innerMinorBorderColor" : "#e0e5ee",
            "maxColumnWidth" : 300,
            "minColumnWidth" : 40,
            "mode" : "variable",
            "numberOfLines" : 1,
            "showActionMenu" : true,
            "showRowIndexColumn" : false,
            "totals" : true,
            "verticalPadding" : 8
          },
          "type" : "table"
        }
      }
    },
    "widgetStyle" : {
      "backgroundColor" : "#FFFFFF",
      "borderColor" : "#E6ECF2",
      "borderEdges" : [ ],
      "borderRadius" : 0,
      "borderWidth" : 1
    },
    "widgets" : {
      "container_1" : {
        "parameters" : {
          "alignmentX" : "left",
          "alignmentY" : "top",
          "fit" : "original"
        },
        "type" : "container"
      },
      "number_2" : {
        "parameters" : {
          "compact" : false,
          "exploreLink" : true,
          "measureField" : "Overall_NPS",
          "numberColor" : "#091A3E",
          "numberSize" : 20,
          "showActionMenu" : true,
          "step" : "Overall_NPS_1",
          "textAlignment" : "center",
          "title" : "",
          "titleColor" : "#091A3E",
          "titleSize" : 20,
          "tooltip" : {
            "customizeTooltip" : false
          }
        },
        "type" : "number"
      },
      "container_2" : {
        "parameters" : {
          "alignmentX" : "left",
          "alignmentY" : "top",
          "fit" : "original"
        },
        "type" : "container"
      },
      "number_1" : {
        "parameters" : {
          "compact" : false,
          "exploreLink" : true,
          "measureField" : "Value",
          "numberColor" : "#FFFFFF",
          "numberSize" : 20,
          "showActionMenu" : true,
          "step" : "Latest_NPS_1",
          "textAlignment" : "center",
          "title" : "",
          "titleColor" : "#091A3E",
          "titleSize" : 20,
          "tooltip" : {
            "customizeTooltip" : false
          }
        },
        "type" : "number"
      },
      "text_1" : {
        "parameters" : {
          "content" : {
            "displayTemplate" : "Net Promoter Score (NPS)"
          },
          "fontSize" : 16,
          "showActionMenu" : true,
          "textAlignment" : "left",
          "textColor" : "#091A3E"
        },
        "type" : "text"
      },
      "image_1" : {
        "parameters" : {
          "alignmentX" : "center",
          "alignmentY" : "center",
          "fit" : "fitheight",
          "image" : {
            "name" : "${App.Images['Loyalty_Member_Snapshot_Iconpng11pn13'].Name}",
            "namespace" : "${Org.Namespace}"
          }
        },
        "type" : "image"
      },
      "text_3" : {
        "parameters" : {
          "content" : {
            "displayTemplate" : "Latest Score"
          },
          "fontSize" : 18,
          "showActionMenu" : true,
          "textAlignment" : "center",
          "textColor" : "#FFFFFF"
        },
        "type" : "text"
      },
      "filterpanel_1" : {
        "parameters" : {
          "filterItemOptions" : {
            "propertyColor" : "#54698D",
            "valueColor" : "#16325C"
          },
          "filters" : [
            {
              "dataset" : {
                "name" : "${App.Datasets.SurveyQuestionResponse2.Name}"
              },
              "field" : "SurveyResponse_CompletionDateTime"
            }
          ],
          "showAllFilters" : false
        },
        "type" : "filterpanel"
      },
      "text_5" : {
        "parameters" : {
          "content" : {
            "displayTemplate" : "Range -100 to +100"
          },
          "fontSize" : 12,
          "showActionMenu" : true,
          "textAlignment" : "center",
          "textColor" : "#091A3E"
        },
        "type" : "text"
      },
      "text_4" : {
        "parameters" : {
          "content" : {
            "displayTemplate" : "Overall Program NPS"
          },
          "fontSize" : 18,
          "showActionMenu" : true,
          "textAlignment" : "center",
          "textColor" : "#091A3E"
        },
        "type" : "text"
      },
      "image_2" : {
        "parameters" : {
          "alignmentX" : "center",
          "alignmentY" : "center",
          "fit" : "fitwidth",
          "image" : {
            "name" : "${App.Images['powered_by_analyticspng11png23'].Name}",
            "namespace" : "${Org.Namespace}"
          }
        },
        "type" : "image"
      },
      "text_6" : {
        "parameters" : {
          "content" : {
            "displayTemplate" : "Out of 10"
          },
          "fontSize" : 12,
          "showActionMenu" : true,
          "textAlignment" : "center",
          "textColor" : "#FFFFFF"
        },
        "type" : "text"
      }
    }
  }
}