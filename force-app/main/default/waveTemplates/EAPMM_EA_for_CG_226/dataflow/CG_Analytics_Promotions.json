{
  "notificationLevel": "",
  "workflowDefinition": {
    "CG_Digest_StoreProduct": {
      "action": "sfdcDigest",
      "parameters": {
        "fields": [
          {"name": "Id"},
          {
            "fiscalMonthOffset": 2,
            "name": "EndDate",
            "isYearEndFiscalYear": false
          },
          {"name": "Name"},
          {"name": "ProductId"},
          {"name": "RetailStoreId"},
          {
            "fiscalMonthOffset": 2,
            "name": "StartDate",
            "isYearEndFiscalYear": false
          }
        ],
        "object": "StoreProduct"
      }
    },
    "CG_CE_PromotionChannel_Filter_RetailStore_Records": {
      "action": "filter",
      "parameters": {
        "source": "CG_CE_PromotionChannel",
        "saqlFilter": "'RetailStoreId' is not null"
      }
    },
    "CG_Augment_Product_onto_PromotionProduct": {
      "action": "augment",
      "parameters": {
        "right_key": ["Id"],
        "left": "CG_Update_PromotionProductCategory_Fill_ProductId_into_new_generated_field",
        "left_key": ["Promotion.ProductId"],
        "right_select": ["Name"],
        "right": "CG_Digest_Product",
        "relationship": "Product",
        "operation": "LookupMultiValue"
      }
    },
    "CG_Register_PromotionProduct_with_PromotionProductCategory": {
      "action": "sfdcRegister",
      "parameters": {
        "name": "CG_PromotionProduct_with_PromotionProductCategory",
        "alias": "${App.Datasets.CG_PromotionProduct_with_PromotionProductCategory21_tp.FullyQualifiedName}",
        "source": "CG_Augment_ProductCategory1_onto_PromotionProduct"
      }
    },
    "CG_Augment_Store_onto_PromotionChannel_Account_Records": {
      "action": "augment",
      "parameters": {
        "right_key": ["AccountId"],
        "left": "CG_CE_PromotionChannel_Filter_Account_Records",
        "left_key": ["AccountId"],
        "right_select": [
          "Id",
          "Name"
        ],
        "right": "CG_Edgemart_RetailStore",
        "relationship": "RetailStore",
        "operation": "LookupMultiValue"
      }
    },
    "CG_Register_StoreProduct": {
      "action": "sfdcRegister",
      "parameters": {
        "name": "CG_StoreProduct",
        "alias": "${App.Datasets.CG_StoreProduct21_tp.FullyQualifiedName}",
        "source": "CG_Augment_PromotionProduct_onto_StoreProduct"
      }
    },
    "CG_CE_PromotionChannel": {
      "action": "computeExpression",
      "parameters": {
        "source": "CG_Augment_Promotion_onto_PromotionChannel",
        "mergeWithSource": true,
        "computedFields": [
          {
            "name": "Dummy_Key",
            "saqlExpression": "\"NA\"",
            "label": "Dummy_Key",
            "type": "Text"
          },
          {
            "name": "EndDate_Temp",
            "saqlExpression": "coalesce(toDate('EndDate', \"yyyy-MM-dd\"), toDate('Promotion.EndDate', \"yyyy-MM-dd\"))",
            "format": "yyyy-MM-dd",
            "label": "EndDate_Temp",
            "type": "Date",
            "isYearEndFiscalYear": true
          },
          {
            "fiscalMonthOffset": 2,
            "name": "EndDate_Computed",
            "saqlExpression": "case when coalesce(toDate('EndDate', \"yyyy-MM-dd\"), toDate('Promotion.EndDate', \"yyyy-MM-dd\")) is null then case when toDate('StartDate', \"yyyy-MM-dd\") >= toDate(date_to_string(now(),\"yyyy-MM-dd\"), \"yyyy-MM-dd\") then toDate('StartDate', \"yyyy-MM-dd\") else toDate(date_to_string(now(),\"yyyy-MM-dd\"), \"yyyy-MM-dd\") end else coalesce(toDate('EndDate', \"yyyy-MM-dd\"), toDate('Promotion.EndDate', \"yyyy-MM-dd\")) end",
            "format": "yyyy-MM-dd",
            "label": "EndDate_Computed",
            "type": "Date",
            "isYearEndFiscalYear": false
          }
        ]
      }
    },
    "CG_Digest_ProductCategory": {
      "action": "sfdcDigest",
      "parameters": {
        "fields": [
          {"name": "Id"},
          {"name": "Description"},
          {"name": "Name"}
        ],
        "object": "ProductCategory"
      }
    },
    "CG_Digest_PromotionChannel": {
      "action": "sfdcDigest",
      "parameters": {
        "fields": [
          {"name": "AccountId"},
          {
            "fiscalMonthOffset": 2,
            "name": "EndDate",
            "isYearEndFiscalYear": false
          },
          {"name": "Id"},
          {"name": "InStoreLocationId"},
          {"name": "Name"},
          {"name": "PromotionId"},
          {"name": "RetailLocationGroupId"},
          {"name": "RetailStoreId"},
          {
            "fiscalMonthOffset": 2,
            "name": "StartDate",
            "isYearEndFiscalYear": false
          }
        ],
        "object": "PromotionChannel"
      }
    },
    "CG_Augment_Store_onto_PromotionChannel_StoreGroup_Records": {
      "action": "augment",
      "parameters": {
        "right_key": ["RetailLocationGroupId"],
        "left": "CG_CE_PromotionChannel_Filter_RetailStoreGroup_Records",
        "left_key": ["RetailLocationGroupId"],
        "right_select": [
          "Id",
          "Name"
        ],
        "right": "CG_Edgemart_RetailStore",
        "relationship": "RetailStore",
        "operation": "LookupMultiValue"
      }
    },
    "CG_Augment_PromotionProductCategory_onto_PromotionChannel": {
      "action": "augment",
      "parameters": {
        "right_key": ["PromotionId"],
        "left": "CG_Augment_PromotionProduct_onto_PromotionChannel",
        "left_key": ["PromotionId"],
        "right_select": [
          "Promotion.ProductCategory.Name",
          "Promotion.ProductCategoryId"
        ],
        "right": "CG_Augment_ProductCategoryProduct_onto_PromotionProductCategory",
        "relationship": "PromotionProductCategory",
        "operation": "LookupMultiValue"
      }
    },
    "CG_Augment_Promotion_onto_PromotionChannel": {
      "action": "augment",
      "parameters": {
        "right_key": ["Id"],
        "left": "CG_Digest_PromotionChannel",
        "left_key": ["PromotionId"],
        "right_select": [
          "EndDate",
          "Name"
        ],
        "right": "CG_Digest_Promotion",
        "relationship": "Promotion",
        "operation": "LookupSingleValue"
      }
    },
    "CG_Digest_ProductCategoryProduct": {
      "action": "sfdcDigest",
      "parameters": {
        "fields": [
          {"name": "Id"},
          {"name": "ProductCategoryId"},
          {"name": "ProductId"},
          {"name": "Name"}
        ],
        "object": "ProductCategoryProduct"
      }
    },
    "CG_Augment_PromotionProduct_onto_PromotionChannel": {
      "action": "augment",
      "parameters": {
        "right_key": ["PromotionId"],
        "left": "CG_Append_All_PromotionChannel_Nodes",
        "left_key": ["PromotionId"],
        "right_select": [
          "Product.Name",
          "ProductId"
        ],
        "right": "CG_Augment_Product_onto_PromotionProduct",
        "relationship": "PromotionProduct",
        "operation": "LookupMultiValue"
      }
    },
    "CG_Augment_PromotionProduct_onto_StoreProduct": {
      "action": "augment",
      "parameters": {
        "right_key": ["Promotion.ProductId"],
        "left": "CG_Augment_RetailStore_onto_StoreProduct",
        "left_key": ["ProductId"],
        "right_select": ["PromotionId"],
        "right": "CG_Augment_ProductCategory1_onto_PromotionProduct",
        "relationship": "PromotionProduct",
        "operation": "LookupMultiValue"
      }
    },
    "CG_Register_PromotionChannel": {
      "action": "sfdcRegister",
      "parameters": {
        "name": "CG_PromotionChannel",
        "alias": "${App.Datasets.CG_PromotionChannel36_tp.FullyQualifiedName}",
        "source": "CG_Augment_PromotionProductCategory_onto_PromotionChannel"
      }
    },
    "CG_Augment_ProductCategory1_onto_PromotionProduct": {
      "action": "augment",
      "parameters": {
        "right_key": ["Id"],
        "left": "CG_Augment_Product_onto_PromotionProduct",
        "left_key": ["Promotion.ProductCategoryId"],
        "right_select": ["Name"],
        "right": "CG_Digest_ProductCategory",
        "relationship": "ProductCategory",
        "operation": "LookupMultiValue"
      }
    },
    "CG_Augment_Store_onto_PromotionChannel_Store_Records": {
      "action": "augment",
      "parameters": {
        "right_key": ["Id"],
        "left": "CG_CE_PromotionChannel_Filter_RetailStore_Records",
        "left_key": ["RetailStoreId"],
        "right_select": [
          "Id",
          "Name"
        ],
        "right": "CG_Edgemart_RetailStore",
        "relationship": "RetailStore",
        "operation": "LookupSingleValue"
      }
    },
    "CG_Digest_PromotionProductCategory": {
      "action": "sfdcDigest",
      "parameters": {
        "fields": [
          {"name": "ProductCategoryId"},
          {"name": "PromotionId"},
          {"name": "Id"},
          {"name": "Name"}
        ],
        "object": "PromotionProductCategory"
      }
    },
    "CG_Append_PromotionProduct_with_PromotionProductCategory": {
      "action": "append",
      "parameters": {
        "enableDisjointedSchemaMerge": true,
        "sources": [
          "CG_Augment_ProductCategoryProduct_onto_PromotionProductCategory",
          "CG_Augment_ProductCategory_onto_PromotionProduct"
        ]
      }
    },
    "CG_Digest_PromotionProduct": {
      "action": "sfdcDigest",
      "parameters": {
        "fields": [
          {"name": "Id"},
          {"name": "Name"},
          {"name": "ProductId"},
          {"name": "PromotionId"}
        ],
        "object": "PromotionProduct"
      }
    },
    "CG_CE_PromotionChannel_Filter_Account_Records": {
      "action": "filter",
      "parameters": {
        "source": "CG_CE_PromotionChannel",
        "saqlFilter": "'AccountId' is not null && 'RetailStoreId' is null"
      }
    },
    "CG_CE_PromotionChannel_Filter_RetailStoreGroup_Records": {
      "action": "filter",
      "parameters": {
        "source": "CG_CE_PromotionChannel",
        "saqlFilter": "'RetailLocationGroupId' is not null && 'RetailStoreId' is null && 'AccountId' is null"
      }
    },
    "CG_Update_PromotionProductCategory_Fill_ProductId_into_new_generated_field": {
      "action": "update",
      "parameters": {
        "right_key": [
          "PromotionId",
          "ProductId"
        ],
        "left": "CG_Append_PromotionProduct_with_PromotionProductCategory",
        "left_key": [
          "PromotionId",
          "ProductId"
        ],
        "update_columns": {"Promotion.ProductId": "ProductId"},
        "right": "CG_Digest_PromotionProduct"
      }
    },
    "CG_Digest_Promotion": {
      "action": "sfdcDigest",
      "parameters": {
        "fields": [
          {"name": "Id"},
          {
            "fiscalMonthOffset": 2,
            "name": "EndDate",
            "isYearEndFiscalYear": false
          },
          {"name": "Name"},
          {
            "fiscalMonthOffset": 2,
            "name": "StartDate",
            "isYearEndFiscalYear": false
          }
        ],
        "object": "Promotion"
      }
    },
    "CG_Augment_ProductCategory_onto_PromotionProduct": {
      "action": "augment",
      "parameters": {
        "right_key": ["ProductId"],
        "left": "CG_Digest_PromotionProduct",
        "left_key": ["ProductId"],
        "right_select": ["ProductCategoryId"],
        "right": "CG_Digest_ProductCategoryProduct",
        "relationship": "Promotion",
        "operation": "LookupSingleValue"
      }
    },
    "CG_Append_All_PromotionChannel_Nodes": {
      "action": "append",
      "parameters": {
        "enableDisjointedSchemaMerge": true,
        "sources": [
          "CG_Augment_Store_onto_PromotionChannel_Account_Records",
          "CG_Augment_Store_onto_PromotionChannel_Store_Records",
          "CG_Augment_Store_onto_PromotionChannel_StoreGroup_Records"
        ]
      }
    },
    "CG_Augment_Product_onto_StoreProduct": {
      "action": "augment",
      "parameters": {
        "right_key": ["Id"],
        "left": "CG_Digest_StoreProduct",
        "left_key": ["ProductId"],
        "right_select": ["Name"],
        "right": "CG_Digest_Product",
        "relationship": "Product",
        "operation": "LookupSingleValue"
      }
    },
    "CG_Digest_Product": {
      "action": "sfdcDigest",
      "parameters": {
        "fields": [
          {"name": "Id"},
          {"name": "Family"},
          {"name": "Name"}
        ],
        "object": "Product2"
      }
    },
    "CG_Augment_RetailStore_onto_StoreProduct": {
      "action": "augment",
      "parameters": {
        "right_key": ["Id"],
        "left": "CG_Augment_ProductCategoryProduct_onto_StoreProduct",
        "left_key": ["RetailStoreId"],
        "right_select": [
          "Name",
          "Account.Name",
          "Location.Address.State",
          "Location.Address.City",
          "Location.Name",
          "RetailStoreGroup.Name"
        ],
        "right": "CG_Edgemart_RetailStore",
        "relationship": "RetailStore",
        "operation": "LookupSingleValue"
      }
    },
    "CG_Augment_ProductCategoryProduct_onto_PromotionProductCategory": {
      "action": "augment",
      "parameters": {
        "right_key": ["ProductCategoryId"],
        "left": "CG_Digest_PromotionProductCategory",
        "left_key": ["ProductCategoryId"],
        "right_select": [
          "ProductId",
          "ProductCategoryId",
          "ProductCategory.Name"
        ],
        "right": "CG_Augment_ProductCategory_onto_ProductCategoryProduct",
        "relationship": "Promotion",
        "operation": "LookupMultiValue"
      }
    },
    "CG_Augment_ProductCategory_onto_ProductCategoryProduct": {
      "action": "augment",
      "parameters": {
        "right_key": ["Id"],
        "left": "CG_Digest_ProductCategoryProduct",
        "left_key": ["ProductCategoryId"],
        "right_select": ["Name"],
        "right": "CG_Digest_ProductCategory",
        "relationship": "ProductCategory",
        "operation": "LookupSingleValue"
      }
    },
    "CG_Augment_ProductCategoryProduct_onto_StoreProduct": {
      "action": "augment",
      "parameters": {
        "right_key": ["ProductId"],
        "left": "CG_Augment_Product_onto_StoreProduct",
        "left_key": ["ProductId"],
        "right_select": ["ProductCategory.Name"],
        "right": "CG_Augment_ProductCategory_onto_ProductCategoryProduct",
        "relationship": "ProductCategory",
        "operation": "LookupSingleValue"
      }
    },
    "CG_Edgemart_RetailStore": {
      "action": "edgemart",
      "parameters": {"alias": "${App.Datasets.CG_RetailStore20_tp.FullyQualifiedName}"}
    }
  },
  "_type": "dataflow",
  "description": "CG Analytics - Promotions",
  "MasterLabel": "CG Analytics - Promotions",
  "nextRun": "",
  "WorkflowStatus": "Inactive",
  "isDeletable": true,
  "longRunningAlertInMins": "",
  "DataflowType": "USER",
  "name": "CG_Analytics_Promotions",
  "_url": "/insights/internal_api/v1.0/esObject/workflow//json",
  "_uid": ""
}